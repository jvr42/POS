"use strict";angular.module("posApp",["ngCookies","ngResource","ngSanitize","btford.socket-io","ui.router","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(a,b,c,d){b.otherwise("/"),c.html5Mode(!0),d.interceptors.push("authInterceptor")}]).factory("authInterceptor",["$rootScope","$q","$cookies","$injector",function(a,b,c,d){var e;return{request:function(a){return a.headers=a.headers||{},c.get("token")&&(a.headers.Authorization="Bearer "+c.get("token")),a},responseError:function(a){return 401===a.status?((e||(e=d.get("$state"))).go("login"),c.remove("token"),b.reject(a)):b.reject(a)}}}]).run(["$rootScope","$state","Auth",function(a,b,c){a.$on("$stateChangeStart",function(a,d){d.authenticate&&c.isLoggedIn(function(c){c||(a.preventDefault(),b.go("login"))})})}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("login",{url:"/",templateUrl:"app/account/login/login.html",controller:"LoginCtrl"}).state("logout",{url:"/logout?referrer",referrer:"login",template:"",controller:["$state","Auth",function(a,b){var c="login";b.logout(),a.go(c)}]}).state("signup",{url:"/signup",templateUrl:"app/account/signup/signup.html",controller:"SignupCtrl"}).state("settings",{url:"/settings",templateUrl:"app/account/settings/settings.html",controller:"SettingsCtrl",authenticate:!0})}]).run(["$rootScope",function(a){a.$on("$stateChangeStart",function(a,b,c,d){"logout"===b.name&&d&&d.name&&!d.authenticate&&(b.referrer=d.name)})}]),angular.module("posApp").controller("LoginCtrl",["$scope","Auth","$state",function(a,b,c){a.user={},a.errors={},a.login=function(d){a.submitted=!0,d.$valid&&b.login({rut:a.user.rut,password:a.user.password}).then(function(){c.go("main")})["catch"](function(b){a.errors.other=b.message})}}]),angular.module("posApp").controller("SettingsCtrl",["$scope","User","Auth",function(a,b,c){a.errors={},a.changePassword=function(b){a.submitted=!0,b.$valid&&c.changePassword(a.user.oldPassword,a.user.newPassword).then(function(){a.message="Password successfully changed."})["catch"](function(){b.password.$setValidity("mongoose",!1),a.errors.other="Incorrect password",a.message=""})}}]),angular.module("posApp").controller("SignupCtrl",["$scope","Auth","$state",function(a,b,c){a.user={},a.errors={},a.register=function(d){a.submitted=!0,d.$valid&&b.createUser({name:a.user.name,email:a.user.email,password:a.user.password}).then(function(){c.go("main")})["catch"](function(b){b=b.data,a.errors={},angular.forEach(b.errors,function(b,c){d[c].$setValidity("mongoose",!1),a.errors[c]=b.message})})}}]),angular.module("posApp").controller("AdminCtrl",["$scope","$http","Auth","User",function(a,b,c,d){a.users=d.query(),a["delete"]=function(b){d.remove({id:b._id}),a.users.splice(this.$index,1)}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("admin",{url:"/admin",templateUrl:"app/admin/admin.html",controller:"AdminCtrl"})}]),angular.module("posApp").controller("BarCtrl",["$scope","$http","socket","Orden",function(a,b,c,d){b.get("/api/ordenes/").then(function(b){a.ordenes=b.data,c.syncUpdates("ordenes",a.ordenes)}),a.listo=function(a,b){_.find(a.productos,{_id:b._id}).servido=!0,d.update({id:a._id},a)},a.check=function(a){return _.find(a.productos,{tipo:"bar"})&&_.find(a.productos,{servido:!1,tipo:"bar"})?!0:!1}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("bar",{url:"/bar",templateUrl:"app/bar/bar.html",controller:"BarCtrl"})}]),angular.module("posApp").controller("CajaCtrl",["$scope","$http","socket","Orden","$modal",function(a,b,c,d,e){b.get("/api/ordenes/").then(function(b){a.ordenes=b.data,c.syncUpdates("ordenes",a.ordenes)}),a["delete"]=function(b){d.remove({id:b._id}),a.ordenes.splice(this.$index,1)},a.productCount=function(a){var b=0;return $.each(a.productos,function(a,c){1==c.servido&&b++}),b+" / "+a.productos.length},a.ver=function(a){e.open({templateUrl:"verOrden.html",controller:"verCtrl",resolve:{orden:function(){return a}}})},a.pay=function(a){e.open({templateUrl:"payOrden.html",controller:"payCtrl",resolve:{orden:function(){return a}}})},a.divide=function(a){e.open({templateUrl:"divideOrden.html",controller:"divideCtrl",resolve:{orden:function(){return a}}})}}]),angular.module("posApp").controller("verCtrl",["$scope","$modalInstance","orden",function(a,b,c){a.orden=c,a.calculateTotal=function(){for(var b=0,c=0;c<a.orden.productos.length;c++){var d=a.orden.productos[c].precio*a.orden.productos[c].cantidad;b+=d}return b},a.calculatePendiente=function(){for(var b=0,c=0,d=0;d<a.orden.productos.length;d++){var e=a.orden.productos[d].pagados*a.orden.productos[d].precio,f=a.orden.productos[d].precio*a.orden.productos[d].cantidad;c+=e,b+=f}return b-c},a.showPagados=function(a){return a.pagados+" / "+a.cantidad},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("posApp").controller("payCtrl",["$scope","$modalInstance","orden",function(a,b,c){a.orden=c,a.calculateTotal=function(){for(var b=0,c=0;c<a.orden.productos.length;c++){var d=a.orden.productos[c].precio*a.orden.productos[c].cantidad;b+=d}return b},a.calculatePendiente=function(){for(var b=0,c=0,d=0;d<a.orden.productos.length;d++){var e=a.orden.productos[d].pagados*a.orden.productos[d].precio,f=a.orden.productos[d].precio*a.orden.productos[d].cantidad;c+=e,b+=f}return b-c},a.cerrar=function(){b.dismiss("cerrar")}}]),angular.module("posApp").controller("divideCtrl",["$scope","$modalInstance","orden","Orden",function(a,b,c,d){a.o=c,a.subticket=[],a.pagar=function(b){var c=_.clone(b);c.cantidad=1,_.find(a.subticket,{_id:c._id})?(_.find(a.subticket,{_id:c._id}).cantidad++,b.pagados++,b.pagados==b.cantidad&&(b.pagado=!0)):(a.subticket.push(c),b.pagados++,b.pagados==b.cantidad&&(b.pagado=!0)),d.update({id:a.o._id},a.o)},a.revertir=function(b){var c=_.clone(b);_.find(a.subticket,{_id:c._id})&&(_.find(a.subticket,{_id:c._id}).cantidad--,b.pagados--,0==_.find(a.subticket,{_id:c._id}).cantidad&&_.remove(a.subticket,{_id:c._id})),d.update({id:a.o._id},a.o)},a.calculateTotal=function(){for(var b=0,c=0;c<a.subticket.length;c++){var d=a.subticket[c].precio*a.subticket[c].cantidad;b+=d}return b},a.cerrar=function(){b.dismiss("cerrar")}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("caja",{url:"/caja",templateUrl:"app/caja/caja.html",controller:"CajaCtrl"})}]),angular.module("posApp").controller("CocinaCtrl",["$scope","$http","socket","Orden",function(a,b,c,d){b.get("/api/ordenes/").then(function(b){a.ordenes=b.data,c.syncUpdates("ordenes",a.ordenes)}),a.listo=function(a,b){_.find(a.productos,{_id:b._id}).servido=!0,d.update({id:a._id},a)},a.check=function(a){return _.find(a.productos,{tipo:"cocina"})&&_.find(a.productos,{servido:!1,tipo:"cocina"})?!0:!1}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("cocina",{url:"/cocina",templateUrl:"app/cocina/cocina.html",controller:"CocinaCtrl"})}]),angular.module("posApp").controller("MainCtrl",["$scope","$http","$state","socket","Producto","Auth",function(a,b,c,d,e,f){a.ticket=[],a.data={tipo:"servir",mesa:"1"},b.get("/api/productos").then(function(b){a.productos=b.data,d.syncUpdates("producto",a.productos)}),a.addTickeToQueue=function(){if(0!=a.ticket.length&&""!=a.tipo){var d={},e=f.getCurrentUser();d.orden_id="",d.status="abierta",d.usuario=e,d.propina="",d.numeroBoleta="",d.fechaCierre="",d.descuento="",d.tipo=a.data.tipo,d.mesa=a.data.mesa,d.productos=a.ticket,d.fecha=(new Date).getTime(),d.fecha_alt=(new Date).toLocaleString(),d.total=a.calculateTotal(),d.servida=!1,b.post("/api/ordenes",d).then(function(){a.ticket=[],a.data.tipo="servir",a.data.mesa="1",c.go("ordenes")})}else alert("Ingrese todos los datos antes de continuar...")},a.addToTicket=function(b){var c=a.ticket.indexOf(b);if(c>=0){var d=a.ticket[c].cantidad,e=d+1;a.ticket[c].cantidad=e}else a.ticket.push(b)},a.deleteItem=function(b){var c=a.ticket.indexOf(b);if(a.ticket[c].cantidad>1){var d=a.ticket[c].cantidad,e=d-1;a.ticket[c].cantidad=e}else a.ticket.splice(c,1)},a.calculateTotal=function(){for(var b=0,c=0;c<a.ticket.length;c++){var d=a.ticket[c].precio*a.ticket[c].cantidad;b+=d}return b},a.$on("$destroy",function(){d.unsyncUpdates("thing")})}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("main",{url:"/main",templateUrl:"app/main/main.html",controller:"MainCtrl"})}]),angular.module("posApp").controller("OrdenesCtrl",["$scope","$http","Auth","socket","$modal",function(a,b,c,d,e){b.get("/api/ordenes/user/"+c.getCurrentUser().name).then(function(b){a.ordenes=b.data,d.syncUpdates("ordenes",a.ordenes)}),a.productCount=function(a){var b=0;return $.each(a.productos,function(a,c){1==c.servido&&b++}),b+" / "+a.productos.length},a.ver=function(a){e.open({templateUrl:"verOrden.html",controller:"verCtrl",resolve:{orden:function(){return a}}})}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("ordenes",{url:"/ordenes",templateUrl:"app/ordenes/ordenes.html",controller:"OrdenesCtrl"})}]),angular.module("posApp").controller("ProductosCtrl",["$scope","Producto","socket",function(a,b,c){a.tipo="cocina",a.productos=b.query(),c.syncUpdates("producto",a.productos),a["delete"]=function(c){b.remove({id:c._id}),a.productos.splice(this.$index,1)},a.add=function(){if(a.name&&a.precio){var c={name:a.name,precio:a.precio,cantidad:1,tipo:a.tipo};b.save(c,function(){a.name="",a.precio="",a.tipo="cocina"})}else alert("Debes completar el formulario antes de ingresar un Producto")},a.edit=function(b){a.editing=!0,a.id=b._id,a.name=b.name,a.precio=b.precio,a.tipo=b.tipo},a.update=function(){a.producto=b.get({id:a.id},function(){a.producto.name=a.name,a.producto.precio=a.precio,a.producto.tipo=a.tipo,a.producto.$update(function(){a.id="",a.name="",a.precio="",a.tipo="cocina",a.editing=!1})})},a.cancelar=function(){a.id="",a.name="",a.precio="",a.tipo="cocina",a.editing=!1},a.$on("$destroy",function(){c.unsyncUpdates("producto")})}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("productos",{url:"/productos",templateUrl:"app/productos/productos.html",controller:"ProductosCtrl"})}]),angular.module("posApp").controller("ReportesCtrl",["$scope",function(a){a.message="Hello"}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("reportes",{url:"/reportes",templateUrl:"app/reportes/reportes.html",controller:"ReportesCtrl"})}]),angular.module("posApp").controller("UsuariosCtrl",["$scope","User","Auth","socket",function(a,b,c,d){a.editing=!1,a.tipo="administrador",a.usuarios=b.query(),d.syncUpdates("user",a.usuarios),a.add=function(){if(a.name&&a.password){var b={name:a.name,rut:a.rut,password:a.password,role:a.tipo};c.createUser(b,function(){a.name="",a.rut="",a.tipo="",a.password=""})}else alert("Completa el formulario antes de ingresar un Usuario")},a.edit=function(b){a.editing=!0,a.id=b._id,a.name=b.name,a.rut=b.rut,a.tipo=b.role,a.password=b.password},a.update=function(){a.user=b.get({id:a.id},function(){a.user.name=a.name,a.user.rut=a.rut,a.user.role=a.tipo,a.user.password=a.password,a.user.$update(function(){a.id="",a.name="",a.rut="",a.tipo="administrador",a.password="",a.editing=!1})})},a.cancelar=function(){a.id="",a.name="",a.rut="",a.tipo="administrador",a.password="",a.editing=!1},a["delete"]=function(c){b.remove({id:c._id}),a.usuarios.splice(this.$index,1)},a.$on("$destroy",function(){d.unsyncUpdates("producto")})}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("usuarios",{url:"/usuarios",templateUrl:"app/usuarios/usuarios.html",controller:"UsuariosCtrl"})}]),angular.module("posApp").service("Orden",["$resource",function(a){return a("/api/ordenes/:id",{id:"@_id"},{update:{method:"PUT"}})}]),angular.module("posApp").service("Producto",["$resource",function(a){return a("/api/productos/:id",{id:"@_id"},{update:{method:"PUT"}})}]),angular.module("posApp").factory("Auth",["$http","User","$cookies","$q",function(a,b,c,d){var e=function(a){return angular.isFunction(a)?a:angular.noop},f={};return c.get("token")&&(f=b.get()),{login:function(g,h){return a.post("/auth/local",{rut:g.rut,password:g.password}).then(function(a){return c.put("token",a.data.token),f=b.get(),f.$promise}).then(function(a){return e(h)(null,a),a})["catch"](function(a){return this.logout(),e(h)(a.data),d.reject(a.data)}.bind(this))},logout:function(){c.remove("token"),f={}},createUser:function(a,c){return b.save(a,function(b){return e(c)(null,a)},function(a){return this.logout(),e(c)(a)}.bind(this)).$promise},changePassword:function(a,c,d){return b.changePassword({id:f._id},{oldPassword:a,newPassword:c},function(){return e(d)(null)},function(a){return e(d)(a)}).$promise},getCurrentUser:function(a){if(0===arguments.length)return f;var b=f.hasOwnProperty("$promise")?f.$promise:f;return d.when(b).then(function(b){return e(a)(b),b},function(){return e(a)({}),{}})},isLoggedIn:function(a){return 0===arguments.length?f.hasOwnProperty("role"):this.getCurrentUser(null).then(function(b){var c=b.hasOwnProperty("role");return e(a)(c),c})},isAdmin:function(a){return 0===arguments.length?"admin"===f.role:this.getCurrentUser(null).then(function(b){var c="admin"===b.role;return e(a)(c),c})},getToken:function(){return c.get("token")}}}]),angular.module("posApp").factory("User",["$resource",function(a){return a("/api/users/:id/:controller",{id:"@_id"},{changePassword:{method:"PUT",params:{controller:"password"}},get:{method:"GET",params:{id:"me"}},update:{method:"PUT"}})}]),angular.module("posApp").directive("footer",function(){return{templateUrl:"components/footer/footer.html",restrict:"E",link:function(a,b){b.addClass("footer")}}}),angular.module("posApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("posApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}}),angular.module("posApp").controller("NavbarCtrl",["$scope","Auth",function(a,b){a.menu=[{title:"Caja",state:"caja"},{title:"Ventas",state:"main"},{title:"Ordenes",state:"ordenes"},{title:"Productos",state:"productos"},{title:"Usuarios",state:"usuarios"},{title:"Visor de Cocina",state:"cocina"},{title:"Visor de Bar",state:"bar"},{title:"Reportes",state:"reportes"}],a.isCollapsed=!0,a.isLoggedIn=b.isLoggedIn,a.isAdmin=b.isAdmin,a.getCurrentUser=b.getCurrentUser}]),angular.module("posApp").directive("navbar",function(){return{templateUrl:"components/navbar/navbar.html",restrict:"E",controller:"NavbarCtrl"}}),angular.module("posApp").factory("socket",["socketFactory",function(a){var b=io("http://pos-perpikaz.rhcloud.com:8000",{path:"/socket.io-client"}),c=a({ioSocket:b});return{socket:c,syncUpdates:function(a,b,d){d=d||angular.noop,c.on(a+":save",function(a){var c=_.find(b,{_id:a._id}),e=b.indexOf(c),f="created";c?(b.splice(e,1,a),f="updated"):b.push(a),d(f,a,b)}),c.on(a+":remove",function(a){var c="deleted";_.remove(b,{_id:a._id}),d(c,a,b)})},unsyncUpdates:function(a){c.removeAllListeners(a+":save"),c.removeAllListeners(a+":remove")}}}]),angular.module("posApp").run(["$templateCache",function(a){a.put("app/account/login/login.html",'<div class=container><div class="panel panel-default" style=margin-top:100px><h3 class=text-center>INICIA SESION</h3><hr><div class=panel-body><div class=container-fluid><div class=row><div class=col-lg-12><form class=form name=form ng-submit=login(form) novalidate><div class=form-group><label>R.U.T</label><input type=rut name=rut class=form-control ng-model=user.rut required></div><div class=form-group><label>Contraseña</label><input type=password name=password class=form-control ng-model=user.password required></div><div class="form-group has-error"><p class=help-block ng-show="form.rut.$error.required && form.password.$error.required && submitted">Please enter your rut and password.</p><p class=help-block ng-show="form.rut.$error.rut && submitted">Please enter a valid email.</p><p class=help-block>{{ errors.other }}</p></div><div class=text-center><button class="btn btn-primary btn btn-login" type=submit>INGRESAR</button></div></form></div></div></div></div></div></div><footer></footer>'),a.put("app/account/settings/settings.html",'<navbar></navbar><div class=container><div class=row><div class=col-sm-12><h1>Change Password</h1></div><div class=col-sm-12><form class=form name=form ng-submit=changePassword(form) novalidate><div class=form-group><label>Current Password</label><input type=password name=password class=form-control ng-model=user.oldPassword mongoose-error><p class=help-block ng-show=form.password.$error.mongoose>{{ errors.other }}</p></div><div class=form-group><label>New Password</label><input type=password name=newPassword class=form-control ng-model=user.newPassword ng-minlength=3 required><p class=help-block ng-show="(form.newPassword.$error.minlength || form.newPassword.$error.required) && (form.newPassword.$dirty || submitted)">Password must be at least 3 characters.</p></div><p class=help-block>{{ message }}</p><button class="btn btn-lg btn-primary" type=submit>Save changes</button></form></div></div></div>'),a.put("app/account/signup/signup.html",'<navbar></navbar><div class=container><div class=row><div class=col-sm-12><h1>Sign up</h1></div><div class=col-sm-12><form class=form name=form ng-submit=register(form) novalidate><div class=form-group ng-class="{ \'has-success\': form.name.$valid && submitted,\n                                            \'has-error\': form.name.$invalid && submitted }"><label>Name</label><input name=name class=form-control ng-model=user.name required><p class=help-block ng-show="form.name.$error.required && submitted">A name is required</p></div><div class=form-group ng-class="{ \'has-success\': form.email.$valid && submitted,\n                                            \'has-error\': form.email.$invalid && submitted }"><label>Email</label><input type=email name=email class=form-control ng-model=user.email required mongoose-error><p class=help-block ng-show="form.email.$error.email && submitted">Doesn\'t look like a valid email.</p><p class=help-block ng-show="form.email.$error.required && submitted">What\'s your email address?</p><p class=help-block ng-show=form.email.$error.mongoose>{{ errors.email }}</p></div><div class=form-group ng-class="{ \'has-success\': form.password.$valid && submitted,\n                                            \'has-error\': form.password.$invalid && submitted }"><label>Password</label><input type=password name=password class=form-control ng-model=user.password ng-minlength=3 required mongoose-error><p class=help-block ng-show="(form.password.$error.minlength || form.password.$error.required) && submitted">Password must be at least 3 characters.</p><p class=help-block ng-show=form.password.$error.mongoose>{{ errors.password }}</p></div><div><button class="btn btn-inverse btn-lg btn-register" type=submit>Sign up</button> <a class="btn btn-default btn-lg btn-login" ui-sref=login>Login</a></div></form></div></div><hr></div>'),a.put("app/admin/admin.html",'<navbar></navbar><div class=container><p>The delete user and user index api routes are restricted to users with the \'admin\' role.</p><ul class=list-group><li class=list-group-item ng-repeat="user in users"><strong>{{user.name}}</strong><br><span class=text-muted>{{user.email}}</span> <a ng-click=delete(user) class=trash><span class="glyphicon glyphicon-trash pull-right"></span></a></li></ul></div>'),a.put("app/bar/bar.html",'<navbar></navbar><div class=container><h3 class=text-center>VISOR DE BARRA</h3><hr><div class=row><div class="col-lg-12 text-left"><div ng-repeat="orden in ordenes" ng-if=check(orden) class="orden col-lg-12 col-xs-12"><div class="panel panel-default"><div class=panel-heading><div class=container-fluid><div class=row><div class="col-lg-4 col-xs-4 text-left"><span style=font-size:20px><b># {{orden.orden_id}}</b></span></div><div class="col-lg-4 col-xs-4 text-center"><span style=font-size:20px ng-if="orden.tipo != \'llevar\'">Mesa: {{orden.mesa}}</span></div><div class="col-lg-4 col-xs-4 text-right"><span style=font-size:20px>{{orden.tipo}}</span></div></div></div></div><div class=panel-body><div ng-repeat="producto in orden.productos" class=productos><div ng-if="producto.tipo == \'bar\'" class=container-fluid><div class=row><div class="col-lg-2 col-xs-2 text-left"><span style=font-size:20px class=badge>{{producto.cantidad}}</span></div><div class="col-lg-5 col-xs-5 text-left"><span style=font-size:20px ng-if="producto.servido == false">{{producto.name}}</span><span style=font-size:20px;text-decoration:line-through ng-if="producto.servido == true">{{producto.name}}</span></div><div class="col-lg-5 col-xs-5 text-right"><button aria-hidden=true ng-click="listo(orden, producto)" class="btn btn-success glyphicon glyphicon-ok"></button></div></div></div></div></div></div></div></div></div></div><footer></footer>'),a.put("app/caja/caja.html",'<navbar></navbar><div class=container><h3 class=text-center>CAJA</h3><hr><div class=row><div class="col-lg-12 text-center"><div class="panel panel-default"><div class=panel-heading><input ng-model=busqueda.orden_id style=height:55px;font-size:26px class="form-control"></div><div class=panel-body><div class=container-fluid><div class=row><div ng-repeat="orden in ordenes |  filter:busqueda" class="col-lg-6 col-lg-12"><div class="panel panel-default"><div class=panel-heading><div class=container-fluid><div class=row style=font-size:26px><div class="col-lg-6 col-xs-6 text-left"># {{orden.orden_id}}</div><div class="col-lg-6 col-xs-6 text-right">{{productCount(orden)}}</div></div></div></div><div class=panel-body><div class=container-fluid><button aria-hidden=true style="font-size: 30px" class="btn-lg btn-success glyphicon glyphicon-pencil"></button> <button aria-hidden=true ng-click=ver(orden) style="font-size: 30px" class="btn-lg btn-primary glyphicon glyphicon-search"></button> <button aria-hidden=true ng-click=delete(orden) ng-if="orden.status != \'Borrado\'" style="font-size: 30px" class="btn-lg btn-danger glyphicon glyphicon-remove"></button> <button aria-hidden=true ng-click=pay(orden) ng-if="orden.status != \'Borrado\'" style="font-size: 30px" class="btn-lg btn-success glyphicon glyphicon-usd"></button> <button aria-hidden=true ng-click=divide(orden) ng-if="orden.status != \'Borrado\'" style="font-size: 30px" class="btn-lg btn-success glyphicon glyphicon-th-list"></button></div></div></div></div></div></div></div></div></div></div></div><footer></footer><script type=text/ng-template id=verOrden.html><div class="modal-header">\n        <h3 class="modal-title">Detalles de orden # {{orden.orden_id}}</h3>\n    </div>\n    <div class="modal-body">\n      <div><b>Orden ingresada por:</b> {{orden.usuario.name}}</div>\n      <div><b>Fecha:</b> {{ orden.fecha | date : \'d-M-yyyy - h:mm:ss a\' }}</div>\n      <div><b>Tipo de orden:</b> {{orden.tipo}}</div>\n      <div><b>Mesa:</b> {{orden.mesa}}</div>\n      <hr>\n      <div class="table-responsive">\n        <table class="table">\n          <thead>\n            <th class="text-left">Pagado</th>\n            <th>Cantidad</th>\n            <th>Producto</th>\n            <th>Precio</th>\n            <th class="text-center">Servido</td>\n          </thead>\n          <tr ng-repeat="producto in orden.productos">\n            <td class="text-left"><span ng-if="producto.pagado == false">{{showPagados(producto)}}</span><span ng-if="producto.pagado == true"  class="glyphicon glyphicon-ok"></span></td>\n            <td>{{producto.cantidad}}</td>\n            <td>{{producto.name}}</td>\n            <td>{{producto.precio * producto.cantidad | currency }}</td>\n            <td ng-if="producto.servido == true" class="text-center"><span class="glyphicon glyphicon-ok"></span></td>\n          </tr>\n        </table>\n      </div>\n      <hr>\n      <div class="text-center"><b>Total:</b> {{calculateTotal()  | currency}} | <b>Pendiente:</b> {{calculatePendiente()  | currency}}</div>\n    </div>\n    <div class="modal-footer">\n        <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>\n    </div></script><script type=text/ng-template id=payOrden.html><div class="modal-header">\n        <h3 class="modal-title">Pagar orden # {{orden.orden_id}}</h3>\n    </div>\n    <div class="modal-body">\n      <div><b>Orden ingresada por:</b> {{orden.usuario.name}}</div>\n      <div><b>Fecha:</b> {{ orden.fecha | date : \'d-M-yyyy - h:mm:ss a\' }}</div>\n      <div><b>Tipo de orden:</b> {{orden.tipo}}</div>\n      <div><b>Mesa:</b> {{orden.mesa}}</div>\n      <hr>\n      <div class="table-responsive">\n        <table class="table">\n          <thead>\n            <th class="text-left">Pagado</th>\n            <th>Cantidad</th>\n            <th>Producto</th>\n            <th>Precio</th>\n            <th class="text-center">Servido</td>\n          </thead>\n          <tr ng-repeat="producto in orden.productos">\n            <td class="text-left"><span ng-if="producto.pagado == false">{{showPagados(producto)}}</span><span ng-if="producto.pagado == true"  class="glyphicon glyphicon-ok"></span></td>\n            <td>{{producto.cantidad}}</td>\n            <td>{{producto.name}}</td>\n            <td>{{producto.precio * producto.cantidad | currency }}</td>\n            <td ng-if="producto.servido == true" class="text-center"><span class="glyphicon glyphicon-ok"></span></td>\n          </tr>\n        </table>\n      </div>\n      <hr>\n      <div class="text-center"><b>Total:</b> {{calculateTotal()  | currency}} | <b>Pendiente:</b> {{calculatePendiente()  | currency}}</div>\n    </div>\n    <div class="modal-footer">\n        <button class="btn btn-warning" type="button" ng-click="cerrar()">Cancel</button>\n    </div></script><script type=text/ng-template id=divideOrden.html><div class="modal-header">\n        <h3 class="modal-title">Dividir Cuenta # {{o.orden_id}}</h3>\n    </div>\n    <div class="modal-body">\n      <div><b>Orden ingresada por:</b> {{o.usuario.name}}</div>\n      <div><b>Fecha:</b> {{ o.fecha | date : \'d-M-yyyy - h:mm:ss a\' }}</div>\n      <div><b>Tipo de orden:</b> {{o.tipo}}</div>\n      <div><b>Mesa:</b> {{o.mesa}}</div>\n      <hr>\n      <div class="table-responsive">\n        <table class="table">\n          <thead>\n            <th>Cantidad</th>\n            <th>Producto</th>\n            <th>Precio</th>\n            <th>Pagar</th>\n          </thead>\n          <tr ng-repeat="producto in o.productos" ng-if="producto.pagado == false">\n            <td>{{producto.cantidad - producto.pagados}}</td>\n            <td>{{producto.name}}</td>\n            <td>{{producto.precio | currency }}</td>\n            <td><button class="btn btn-success" ng-if="producto.pagado == false" ng-click="pagar(producto)"><span class="glyphicon glyphicon-usd"></span></button><button class="btn btn-danger" ng-if="producto.pagado == false" ng-click="revertir(producto)"><span class="glyphicon glyphicon-usd"></span></button></td>\n          </tr>\n        </table>\n      </div>\n      <hr>\n      <div class="table-responsive">\n        <table class="table">\n          <thead>\n            <th>Cantidad</th>\n            <th>Producto</th>\n            <th>Precio</th>\n          </thead>\n          <tr ng-repeat="item in subticket">\n            <td>{{item.cantidad}}</td>\n            <td>{{item.name}}</td>\n            <td>{{item.precio * item.cantidad | currency }}</td>\n          </tr>\n        </table>\n      </div>\n      <div class="text-center"><b>Total:</b> {{calculateTotal() | currency}}</div>\n    </div>\n    <div class="modal-footer">\n        <div class="text-center">\n        <button class="btn-lg btn-warning" type="button" ng-click="cerrar()">CERRAR</button>\n        </div>\n    </div></script>'),a.put("app/cocina/cocina.html",'<navbar></navbar><div class=container><h3 class=text-center>VISOR DE COCINA</h3><hr><div class=row><div class="col-lg-12 text-left"><div ng-repeat="orden in ordenes" ng-if=check(orden) class="orden col-lg-12 col-xs-12"><div class="panel panel-default"><div class=panel-heading><div class=container-fluid><div class=row><div class="col-lg-4 col-xs-4 text-left"><span style=font-size:20px><b># {{orden.orden_id}}</b></span></div><div class="col-lg-4 col-xs-4 text-center"><span style=font-size:20px ng-if="orden.tipo != \'llevar\'">Mesa: {{orden.mesa}}</span></div><div class="col-lg-4 col-xs-4 text-right"><span style=font-size:20px>{{orden.tipo}}</span></div></div></div></div><div class=panel-body><div ng-repeat="producto in orden.productos" class=productos><div ng-if="producto.tipo == \'cocina\'" class=container-fluid><div class=row><div class="col-lg-2 col-xs-2 text-left"><span style=font-size:20px class=badge>{{producto.cantidad}}</span></div><div class="col-lg-5 col-xs-5 text-left"><span style=font-size:20px ng-if="producto.servido == false">{{producto.name}}</span><span style=font-size:20px;text-decoration:line-through ng-if="producto.servido == true">{{producto.name}}</span></div><div class="col-lg-5 col-xs-5 text-right"><button aria-hidden=true ng-click="listo(orden, producto)" class="btn btn-success glyphicon glyphicon-ok"></button></div></div></div></div></div></div></div></div></div></div><footer></footer>'),a.put("app/main/main.html",'<navbar></navbar><div class=container><h3 class=text-center>VENTAS</h3><hr><div class=row><div class=col-lg-6><div class="panel panel-default"><div class=panel-body><div class=row><div class=col-lg-4>Tipo de Orden:</div><div class=col-lg-8><select name=tipo ng-model=data.tipo class=form-control><option value=servir>Servir</option><option value=llevar>Llevar</option></select></div></div><div ng-if="data.tipo == \'servir\'" class=row><div class=col-lg-4>Mesa:</div><div class=col-lg-8><select name=mesa ng-model=data.mesa class=form-control><option value=1>1</option><option value=2>2</option><option value=3>3</option><option value=4>4</option><option value=5>5</option><option value=6>6</option><option value=7>7</option><option value=8>8</option><option value=9>9</option><option value=10>10</option></select></div></div><hr><div ng-repeat="item in ticket" class=container-fluid style=font-size:18px><div class=row><div class="col-lg-2 col-xs-2"><span class=badge style=font-size:18px>{{item.cantidad}}</span></div><div class="col-lg-4 col-xs-4 text-left">{{item.name}}</div><div class="col-lg-4 col-xs-4">{{item.precio * item.cantidad | currency}}</div><div class="col-lg-2 col-xs-2 text-rigth"><button aria-hidden=true ng-click=deleteItem(item) class="btn btn-danger glyphicon glyphicon-remove"></button></div></div><hr></div><div class=container-fluid><div class=row><div class="col-lg-12 text-center" style=font-size:18px>{{ calculateTotal() | currency }}</div></div><div class=row><div class="col-lg-12 text-center"><hr><button ng-click=addTickeToQueue() class="btn-lg btn-success">INGRESAR</button></div></div></div></div></div></div><div class=col-lg-6><div class="panel panel-default"><div class="panel-heading text-center"><input ng-model=producto class=form-control style="height:55px;font-size:26px"></div><div class=panel-body><div class=container-fluid><div class=row><div style="margin-bottom:10px;padding-top:10px;padding-bottom:10px;font-size:24px;white-space: normal" ng-repeat="producto in productos | filter:producto" ng-click=addToTicket(producto) class="col-lg-12 col-xs-12 btn btn-default">{{producto.name}}</div></div></div></div></div></div></div></div><footer></footer>'),
a.put("app/ordenes/ordenes.html",'<navbar></navbar><div class=container><h3 class=text-center>ORDENES</h3><hr><div class=row><div class="col-lg-12 text-center"><div class="panel panel-default"><div class=panel-heading><input ng-model=busqueda.orden_id style=height:55px;font-size:26px class="form-control"></div><div class=panel-body><div class=container-fluid><div class=row><div ng-repeat="orden in ordenes |  filter:busqueda" class="col-lg-6 col-lg-12"><div class="panel panel-default"><div class=panel-heading><div class=container-fluid><div class=row style=font-size:26px><div class="col-lg-6 col-xs-6 text-left"># {{orden.orden_id}}</div><div class="col-lg-6 col-xs-6 text-right">{{productCount(orden)}}</div></div></div></div><div class=panel-body><div class=container-fluid><button aria-hidden=true style="font-size: 30px" class="btn-lg btn-success glyphicon glyphicon-pencil"></button> <button aria-hidden=true ng-click=ver(orden) style="font-size: 30px" class="btn-lg btn-primary glyphicon glyphicon-search"></button></div></div></div></div></div></div></div></div></div></div></div><footer></footer><script type=text/ng-template id=verOrden.html><div class="modal-header">\n        <h3 class="modal-title">Detalles de orden # {{orden.orden_id}}</h3>\n    </div>\n    <div class="modal-body">\n      <div><b>Orden ingresada por:</b> {{orden.usuario.name}}</div>\n      <div><b>Fecha:</b> {{ orden.fecha | date : \'d-M-yyyy - h:mm:ss a\' }}</div>\n      <div><b>Tipo de orden:</b> {{orden.tipo}}</div>\n      <div><b>Mesa:</b> {{orden.mesa}}</div>\n      <hr>\n      <div class="table-responsive">\n        <table class="table">\n          <thead>\n            <th class="text-left">Pagado</th>\n            <th>Cantidad</th>\n            <th>Producto</th>\n            <th>Precio</th>\n            <th class="text-center">Servido</td>\n          </thead>\n          <tr ng-repeat="producto in orden.productos">\n            <td class="text-left"><span ng-if="producto.pagado == false">{{showPagados(producto)}}</span><span ng-if="producto.pagado == true"  class="glyphicon glyphicon-ok"></span></td>\n            <td>{{producto.cantidad}}</td>\n            <td>{{producto.name}}</td>\n            <td>{{producto.precio * producto.cantidad | currency }}</td>\n            <td ng-if="producto.servido == true" class="text-center"><span class="glyphicon glyphicon-ok"></span></td>\n          </tr>\n        </table>\n      </div>\n      <hr>\n      <div class="text-center"><b>Total:</b> {{calculateTotal()  | currency}}</div>\n    </div>\n    <div class="modal-footer">\n        <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>\n    </div></script>'),a.put("app/productos/productos.html",'<navbar></navbar><div class=container><h3 class=text-center>PRODUCTOS</h3><hr><div class=row><div class=col-lg-4><div class="panel panel-default"><div class=panel-body><form id=producto-form><div class=row><div class=col-lg-12><div id=error-message></div><label style=margin-top:10px>Nombre:</label><input name=nombre class=form-control ng-model="name"><label style=margin-top:10px>Precio:</label><input name=precio class=form-control ng-model="precio"><label style=margin-top:10px>Tipo:</label><select name=tipo class=form-control ng-model=tipo><option value=cocina>Cocina</option><option value=bar>Bar</option></select></div></div><div class=row><div class="col-lg-12 text-right"><button style=margin-top:20px ng-click=cancelar() ng-if="editing == true" class="btn btn-danger">CANCELAR</button> <button style=margin-top:20px ng-if="editing == true" ng-click=update() class="btn btn-success">ACTUALIZAR</button> <button style=margin-top:20px ng-if="editing != true" ng-click=add() class="btn btn-primary">INGRESAR</button></div></div></form></div></div></div><div class=col-lg-8><div class="panel panel-default"><div class="panel-heading text-center"><input class=form-control ng-model=search style=height:55px;font-size:26px></div><div class=panel-body><table class="table text-center"><thead style=font-weight:bold><td>Nombre</td><td>Precio</td><td>Editar</td></thead><tbody><tr ng-repeat="producto in productos  |  filter:search"><td>{{producto.name}}</td><td>{{producto.precio | currency}}</td><td><button aria-hidden=true ng-click=edit(producto) class="btn btn-success glyphicon glyphicon-pencil"></button> <button aria-hidden=true ng-click=delete(producto) class="btn btn-danger glyphicon glyphicon-remove"></button></td></tr></tbody></table></div></div></div></div></div>'),a.put("app/reportes/reportes.html","<navbar></navbar><div class=container>Reportes</div><footer></footer>"),a.put("app/usuarios/usuarios.html",'<navbar></navbar><div class=container><h3 class=text-center>USUARIOS</h3><hr><div class=row><div class="col-lg-4 text-left"><div class="panel panel-default"><div class=panel-body><form id=usuario-form><div class=row><div class=col-lg-12><div id=error-message></div><label style=margin-top:10px>Nombre:</label><input name=nombre class=form-control ng-model="name"><label style=margin-top:10px>R.U.T:</label><input name=rut class=form-control ng-model="rut"><label style=margin-top:10px>Contraseña:</label><input name=password class=form-control ng-model="password"><label style=margin-top:10px>Tipo de Usuario:</label><select ng-model=tipo required class=form-control><option value=administrador>Administrador</option><option value=caja>Caja</option><option value=cocina>Cocina</option><option value=mesero>Mesero</option><option value=bar>Bar</option></select></div></div><div class=row><div class="col-lg-12 text-right"><button style=margin-top:20px ng-click=add() ng-if="editing != true" class="btn btn-primary">INGRESAR</button> <button style=margin-top:20px ng-click=cancelar() ng-if="editing == true" class="btn btn-danger">CANCELAR</button> <button style=margin-top:20px ng-click=update() ng-if="editing == true" class="btn btn-success">ACTUALIZAR</button></div></div></form></div></div></div><div class="col-lg-8 text-center"><div class="panel panel-default"><div class=panel-body><div class=table-responsive><table class="table text-center"><thead style=font-weight:bold><td>Nombre</td><td>R.U.T</td><td>Rol</td><td>Editar</td></thead><tbody><tr ng-repeat="usuario in usuarios"><td>{{usuario.name}}</td><td>{{usuario.rut}}</td><td>{{usuario.role}}</td><td><button aria-hidden=true ng-click=edit(usuario) class="btn btn-success glyphicon glyphicon-pencil"></button> <button aria-hidden=true ng-click=delete(usuario) class="btn btn-danger glyphicon glyphicon-remove"></button></td></tr></tbody></table></div></div></div></div></div></div><footer></footer>'),a.put("components/footer/footer.html","<div class=container><p>Sistema de Ventas v3.0 | <a href=#>Jesus Villarroel</a> | <a href=#>jvr42@hotmail.com</a></p></div>"),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<div class="navbar navbar-default navbar-static-top" ng-controller=NavbarCtrl><div class=container><div class=navbar-header><button class=navbar-toggle type=button ng-click="isCollapsed = !isCollapsed"><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href="/" class=navbar-brand>pos</a></div><div collapse=isCollapsed class="navbar-collapse collapse" id=navbar-main><ul class="nav navbar-nav"><li ng-repeat="item in menu" ui-sref-active=active><a ng-show=isLoggedIn() ui-sref={{item.state}}>{{item.title}}</a></li></ul><ul class="nav navbar-nav navbar-right"><li ng-hide=isLoggedIn() ui-sref-active=active><a ui-sref=login>Iniciar Sesion</a></li><li ng-show=isLoggedIn()><p class=navbar-text>{{ getCurrentUser().name }}</p></li><li ng-show=isLoggedIn()><a ui-sref=logout>Cerrar Sesion</a></li></ul></div></div></div>')}]);