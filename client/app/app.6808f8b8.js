"use strict";angular.module("posApp",["ngCookies","ngResource","ngSanitize","btford.socket-io","ui.router","ui.bootstrap","datatables"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(a,b,c,d){b.otherwise("/"),c.html5Mode(!0),d.interceptors.push("authInterceptor")}]).factory("authInterceptor",["$rootScope","$q","$cookies","$injector",function(a,b,c,d){var e;return{request:function(a){return a.headers=a.headers||{},c.get("token")&&(a.headers.Authorization="Bearer "+c.get("token")),a},responseError:function(a){return 401===a.status?((e||(e=d.get("$state"))).go("login"),c.remove("token"),b.reject(a)):b.reject(a)}}}]).run(["$rootScope","$state","Auth",function(a,b,c){a.$on("$stateChangeStart",function(a,d){d.authenticate&&c.isLoggedIn(function(c){c||(a.preventDefault(),b.go("login"))})})}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("login",{url:"/",templateUrl:"app/account/login/login.html",controller:"LoginCtrl"}).state("logout",{url:"/logout?referrer",referrer:"login",template:"",controller:["$state","Auth",function(a,b){var c="login";b.logout(),a.go(c)}]}).state("signup",{url:"/signup",templateUrl:"app/account/signup/signup.html",controller:"SignupCtrl"}).state("settings",{url:"/settings",templateUrl:"app/account/settings/settings.html",controller:"SettingsCtrl",authenticate:!0})}]).run(["$rootScope",function(a){a.$on("$stateChangeStart",function(a,b,c,d){"logout"===b.name&&d&&d.name&&!d.authenticate&&(b.referrer=d.name)})}]),angular.module("posApp").controller("LoginCtrl",["$scope","Auth","$state",function(a,b,c){a.user={},a.errors={},a.login=function(d){a.submitted=!0,d.$valid&&b.login({rut:a.user.rut,password:a.user.password}).then(function(a){"cocina"==a.role?c.go("cocina"):"bar"==a.role?c.go("bar"):c.go("main")})["catch"](function(b){a.errors.other=b.message})}}]),angular.module("posApp").controller("ArchivoCtrl",["$scope","$http","Auth","socket","$modal","$state",function(a,b,c,d,e,f){c.isLoggedIn(function(a){a||f.go("login")}),a.cargando=!0,b.get("/api/ordenes/all").then(function(b){a.ordenes=b.data,a.cargando=!1}),a.abierta=function(a){return"cerrada"==a.status?!1:!0},a.productCount=function(a){var b=0;return $.each(a.productos,function(a,c){1==c.servido&&b++}),b+" / "+a.productos.length},a.edit=function(a){f.go("editar",{id:a})},a.ver=function(a){e.open({templateUrl:"verOrden.html",controller:"verCtrl",resolve:{orden:function(){return a}}})}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("archivo",{url:"/archivo",templateUrl:"app/archivo/archivo.html",controller:"ArchivoCtrl"})}]),angular.module("posApp").controller("BarCtrl",["$scope","$http","socket","Orden","Auth","$state",function(a,b,c,d,e,f){e.isLoggedIn(function(a){a||f.go("login")}),b.get("/api/ordenes/").then(function(b){a.ordenes=b.data,c.syncUpdates("ordenes",a.ordenes)}),a.listo=function(a,b){_.find(a.productos,{_id:b._id}).servido=!0,d.update({id:a._id},a)},a.revisa=function(a){return _.find(a.productos,{tipo:"bar"})&&_.find(a.productos,{servido:!1,tipo:"bar"})?!0:!1}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("bar",{url:"/bar",templateUrl:"app/bar/bar.html",controller:"BarCtrl"})}]),angular.module("posApp").controller("CajaCtrl",["$scope","$http","socket","Orden","$modal","$state","Modal","Auth",function(a,b,c,d,e,f,g,h){h.isLoggedIn(function(a){a||f.go("login")}),a.user="",a.orden_id="",a.totalOrdenes=0,b.get("/api/users").success(function(b){a.usuarios=b}),b.get("/api/ordenes/").then(function(b){a.ordenes=b.data,c.syncUpdates("ordenes",a.ordenes),a.totalOrdenes=a.ordenes.length}),a["delete"]=function(a){e.open({templateUrl:"deleteOrden.html",controller:"deleteCtrl",resolve:{orden:function(){return a}}})},a.abierta=function(a){return"cerrada"==a.status||"Borrado"==a.status?!1:!0},a.productCount=function(a){var b=0;return $.each(a.productos,function(a,c){1==c.servido&&b++}),b+" / "+a.productos.length},a.edit=function(a){f.go("editar",{id:a})},a.ver=function(a){e.open({templateUrl:"verOrden.html",controller:"verCtrl",resolve:{orden:function(){return a}}})},a.pay=function(a){e.open({templateUrl:"payOrden.html",controller:"payCtrl",resolve:{orden:function(){return a}}})},a.divide=function(a){e.open({templateUrl:"divideOrden.html",controller:"divideCtrl",resolve:{orden:function(){return a}}})}}]),angular.module("posApp").controller("deleteCtrl",["$scope","$modalInstance","orden","Orden",function(a,b,c,d){a.orden=c,a.observacion="",a.borrar=function(){a.orden.observacion=a.observacion,a.orden.status="Borrado",d.update({id:a.orden._id},a.orden,function(){b.dismiss()})}}]),angular.module("posApp").controller("verCtrl",["$scope","$modalInstance","orden","$state",function(a,b,c,d){a.orden=c,a.calculateTotal=function(){for(var b=0,c=0;c<a.orden.productos.length;c++){var d=a.orden.productos[c].precio*a.orden.productos[c].cantidad;b+=d}return b},a.print=function(b){window.open("ticket/"+b,"","width=1000"),a.cancel()},a.calculatePendiente=function(){for(var b=0,c=0,d=0;d<a.orden.productos.length;d++){var e=a.orden.productos[d].pagados*a.orden.productos[d].precio,f=a.orden.productos[d].precio*a.orden.productos[d].cantidad;c+=e,b+=f}return b-c},a.showPagados=function(a){return a.pagados+" / "+a.cantidad},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("posApp").controller("payCtrl",["$rootScope","$scope","$modalInstance","orden","Orden","$state",function(a,b,c,d,e,f){b.orden=d,b.tipoPago="efectivo",b.propinaclass="success",b.totalPropina=0,b.descuento="0",b.calculateTotal=function(){for(var a=0,c=0;c<b.orden.productos.length;c++){var d=b.orden.productos[c].precio*b.orden.productos[c].cantidad;a+=d}return a},b.calculatePendiente=function(){for(var a=0,c=0,d=0;d<b.orden.productos.length;d++){var e=b.orden.productos[d].pagados*b.orden.productos[d].precio,f=b.orden.productos[d].precio*b.orden.productos[d].cantidad;c+=e,a+=f}return a-c},b.aplicarPropina=function(){b.totalPropina=.1*b.calculatePendiente(),b.totalWithPropina=b.totalPropina+b.calculatePendiente()},b.aplicarDescuento=function(a){b.totalDescuento=Math.ceil((b.totalPropina+b.calculatePendiente())*(a/100)),b.totalMenosDescuento=b.calculatePendiente()-b.totalDescuento,console.log(b)},b.propina=!0,b.aplicarPropina(),b.showPagados=function(a){return a.pagados+" / "+a.cantidad},b.pagar=function(){b.orden.total=b.calculateTotal(),b.orden.propina=b.propina,b.orden.propinaPagada=b.propinaPagada,b.orden.servida=!0,b.orden.descuento=b.totalDescuento,b.orden.fechaCierre=(new Date).getTime(),b.orden.numeroBoleta=b.numeroBoleta,b.orden.tipoPago=b.tipoPago;for(var a=0;a<b.orden.productos.length;a++)b.orden.productos[a].pagado="true",b.orden.productos[a].servido="true";b.orden.status="cerrada",e.update({id:b.orden._id},b.orden),c.dismiss("cerrar")},b.cerrar=function(){c.dismiss("cerrar")}}]),angular.module("posApp").controller("divideCtrl",["$scope","$modalInstance","orden","Orden",function(a,b,c,d){a.o=c,a.subticket=[],a.pagar=function(b){var c=_.clone(b);c.cantidad=1,_.find(a.subticket,{_id:c._id})?(_.find(a.subticket,{_id:c._id}).cantidad++,b.pagados++,b.pagados==b.cantidad?b.pagado=!0:b.pagado=!1):(a.subticket.push(c),b.pagados++,b.pagados==b.cantidad?b.pagado=!0:b.pagado=!1),d.update({id:a.o._id},a.o)},a.revertir=function(b){var c=_.clone(b);_.find(a.subticket,{_id:c._id})&&(_.find(a.subticket,{_id:c._id}).cantidad--,b.pagados--,b.pagados==b.cantidad?b.pagado=!0:b.pagado=!1,0==_.find(a.subticket,{_id:c._id}).cantidad&&_.remove(a.subticket,{_id:c._id})),d.update({id:a.o._id},a.o)},a.calculateTotal=function(){for(var b=0,c=0;c<a.subticket.length;c++){var d=a.subticket[c].precio*a.subticket[c].cantidad;b+=d}return b},a.checkSubticket=function(b){return _.find(a.subticket,{_id:b._id})},a.cerrar=function(){b.dismiss("cerrar")}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("caja",{url:"/caja",templateUrl:"app/caja/caja.html",controller:"CajaCtrl"})}]),angular.module("posApp").controller("CocinaCtrl",["$scope","$http","socket","Orden","Auth","$state",function(a,b,c,d,e,f){e.isLoggedIn(function(a){a||f.go("login")}),b.get("/api/ordenes/").then(function(b){a.ordenes=b.data,c.syncUpdates("ordenes",a.ordenes)}),a.listo=function(a,b){_.find(a.productos,{_id:b._id}).servido=!0,d.update({id:a._id},a)},a.mostrarObservacion=function(a,b){b.showObservacion?b.showObservacion=!1:b.showObservacion=!0},a.revisa=function(a){return _.find(a.productos,{tipo:"cocina"})&&_.find(a.productos,{servido:!1,tipo:"cocina"})?!0:!1}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("cocina",{url:"/cocina",templateUrl:"app/cocina/cocina.html",controller:"CocinaCtrl"})}]),angular.module("posApp").controller("ConfigCtrl",["$scope","Counter","$interval","Auth","$state",function(a,b,c,d,e){d.isLoggedIn(function(a){a||e.go("login")}),b.query(function(b){a.counters=b,a.countId=b[0]._id,a.orden_id=b[0].orden_id}),a.updateCounter=function(c){var d={orden_id:a.orden_id};return b.update({id:a.countId},d),c("Reseteado!")},a.showNotification=function(b){a.notification=b,c(function(){a.notification=""},2e3)}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("config",{url:"/config",templateUrl:"app/config/config.html",controller:"ConfigCtrl"})}]),angular.module("posApp").controller("EditarCtrl",["$scope","$http","$state","socket","Producto","Auth","$stateParams","Orden","Modal","$modal",function(a,b,c,d,e,f,g,h,i,j){f.isLoggedIn(function(a){a||c.go("login")}),a.ticket=[],a.orden_id=g.id,a.userRole=f.getCurrentUser().role,a.data={tipo:"servir",mesa:"t 1",orden_id:""},b.get("/api/ordenes/"+a.orden_id).then(function(b){a.orden=b.data,a.ticket=a.orden.productos,a.data.orden_id=a.orden.orden_id,a.data.tipo=a.orden.tipo,a.data.mesa=a.orden.mesa}),b.get("/api/productos").then(function(b){a.productos=b.data,d.syncUpdates("producto",a.productos)}),a["delete"]=function(b){j.open({templateUrl:"deleteProducto.html",controller:"deleteProductoCtrl",resolve:{item:function(){return b},ticket:function(){return a.orden}}})},a.mostrarObservacion=function(a){a.showObservacion?a.showObservacion=!1:a.showObservacion=!0},a.updateTicket=function(){if(0!=a.ticket.length&&""!=a.tipo){var b={},d=f.getCurrentUser();b.fechaEditado=(new Date).getTime(),b.status="abierta",b.ultimoEditor=d,b.tipo=a.data.tipo,b.mesa=a.data.mesa,b.productos=a.ticket,b.total=a.calculateTotal(),b.servida=!1,h.update({id:a.orden._id},b,function(){a.ticket=[],a.data.tipo="servir",a.data.mesa="1",c.go("ordenes")})}else alert("Ingrese productos a la orden antes de continuar...")},a.addToTicket=function(b){_.find(a.ticket,{_id:b._id})?_.find(a.ticket,{_id:b._id}).cantidad++:(b._id=(new Date).getTime(),a.ticket.push(b))},a.deleteItem=function(b){return _.find(a.ticket,{_id:b._id})?(_.find(a.ticket,{_id:b._id}).cantidad--,0==_.find(a.ticket,{_id:b._id}).cantidad?(_.remove(a.ticket,{_id:b._id}),b.cantidad=1,!0):!0):(_.remove(a.ticket,{_id:b._id}),!0)},a.calculateTotal=function(){for(var b=0,c=0;c<a.ticket.length;c++){var d=a.ticket[c].precio*a.ticket[c].cantidad;b+=d}return b},a.$on("$destroy",function(){d.unsyncUpdates("producto")}),a.$on("productoBorrado",function(b,c,d){a.deleteItem(d);var e={producto:d,observacion:c,fecha:(new Date).getTime()};a.orden.observaciones.push(e),h.update({id:a.orden._id},a.orden)})}]),angular.module("posApp").controller("deleteProductoCtrl",["$rootScope","$scope","$modalInstance","Orden","ticket","item",function(a,b,c,d,e,f){b.showDeleteButton=function(){return void 0==b.observacion||""==b.observacion?!1:!0},b.borrar=function(){a.$broadcast("productoBorrado",b.observacion,f),c.dismiss()}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("editar",{url:"/editar/:id",templateUrl:"app/editar/editar.html",controller:"EditarCtrl"})}]),angular.module("posApp").controller("InsightCtrl",["$scope","DTOptionsBuilder","DTColumnBuilder","$resource",function(a,b,c,d){a.ordenes=[],a.dtOptions=b.fromFnPromise(function(){return d("api/ordenes/insights/index").query().$promise}).withPaginationType("full_numbers"),a.dtColumns=[c.newColumn("orden_id").withTitle("Orde Id"),c.newColumn("fecha_alt").withTitle("Fecha"),c.newColumn("total").withTitle("Total")]}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("insight",{url:"/insight",templateUrl:"app/insight/insight.html",controller:"InsightCtrl"})}]),angular.module("posApp").controller("MainCtrl",["$scope","$http","$state","socket","Producto","Auth","Counter","User",function(a,b,c,d,e,f,g,h){f.isLoggedIn(function(a){a||c.go("login")}),a.u=f.getCurrentUser(),a.ticket=[],a.data={tipo:"servir",mesa:"t 1",u:a.u.name,role:a.u.role},b.get("/api/users").success(function(b){a.usuarios=b}),b.get("/api/productos").then(function(b){a.productos=b.data,d.syncUpdates("producto",a.productos)}),a.mostrarObservacion=function(a){a.showObservacion?a.showObservacion=!1:a.showObservacion=!0},a.addTickeToQueue=function(){if(0!=a.ticket.length&&""!=a.tipo){var d={};h.getByName({id:a.data.u},function(e){var f=e;g.query(function(e){a.CounterObjectId=e[0]._id,a.currentOrdenId=e[0].orden_id,a.orden_id=a.currentOrdenId+1;var h={orden_id:a.orden_id};g.update({id:a.CounterObjectId},h),d.orden_id=a.orden_id,d.fechaEditado=(new Date).getTime(),d.status="abierta",d.usuario=f,d.propina="",d.numeroBoleta="",d.fechaCierre="",d.descuento="",d.tipo=a.data.tipo,d.mesa=a.data.mesa,d.productos=a.ticket,d.fecha=(new Date).getTime(),d.fecha_alt=(new Date).toLocaleString(),d.total=a.calculateTotal(),d.servida=!1,d.observaciones=[],b.post("/api/ordenes",d).then(function(){a.ticket=[],a.data.tipo="servir",a.data.mesa="1",c.go("ordenes")})})})}else alert("Ingrese todos los datos antes de continuar...")},a.addToTicket=function(b){_.find(a.ticket,{_id:b._id})?_.find(a.ticket,{_id:b._id}).cantidad++:(b._id=(new Date).getTime(),a.ticket.push(b))},a.deleteItem=function(b){_.find(a.ticket,{_id:b._id})?(_.find(a.ticket,{_id:b._id}).cantidad--,0==_.find(a.ticket,{_id:b._id}).cantidad&&(_.remove(a.ticket,{_id:b._id}),b.cantidad=1)):_.remove(a.ticket,{_id:b._id})},a.calculateTotal=function(){for(var b=0,c=0;c<a.ticket.length;c++){var d=a.ticket[c].precio*a.ticket[c].cantidad;b+=d}return b},a.$on("$destroy",function(){d.unsyncUpdates("thing")})}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("main",{url:"/main",templateUrl:"app/main/main.html",controller:"MainCtrl"})}]),angular.module("posApp").controller("OrdenesCtrl",["$scope","$http","Auth","socket","$modal","$state",function(a,b,c,d,e,f){c.isLoggedIn(function(a){a||f.go("login")}),b.get("/api/ordenes/user/"+c.getCurrentUser().name).then(function(b){a.ordenes=b.data,d.syncUpdates("ordenes",a.ordenes,function(b,d,e){if(c.getCurrentUser().name!=d.usuario.name){var f=_.find(a.ordenes,{_id:d._id}),g=a.ordenes.indexOf(f);a.ordenes.splice(g,1)}if("cerrada"==d.status){var f=_.find(a.ordenes,{_id:d._id}),g=a.ordenes.indexOf(f);a.ordenes.splice(g,1)}})}),a.abierta=function(a){return"cerrada"==a.status?!1:!0},a.productCount=function(a){var b=0;return $.each(a.productos,function(a,c){1==c.servido&&b++}),b+" / "+a.productos.length},a.edit=function(a){f.go("editar",{id:a})},a.ver=function(a){e.open({templateUrl:"verOrden.html",controller:"verCtrl",resolve:{orden:function(){return a}}})}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("ordenes",{url:"/ordenes",templateUrl:"app/ordenes/ordenes.html",controller:"OrdenesCtrl"})}]),angular.module("posApp").controller("ProductosCtrl",["$scope","Producto","socket","Auth","$state",function(a,b,c,d,e){d.isLoggedIn(function(a){a||e.go("login")}),a.tipo="cocina",a.productos=b.query(),c.syncUpdates("producto",a.productos),a["delete"]=function(c){b.remove({id:c._id}),a.productos.splice(this.$index,1)},a.add=function(){if(a.name&&a.precio){var c={name:a.name,precio:a.precio,cantidad:1,tipo:a.tipo};b.save(c,function(){a.name="",a.precio="",a.tipo="cocina"})}else alert("Debes completar el formulario antes de ingresar un Producto")},a.edit=function(b){a.editing=!0,a.id=b._id,a.name=b.name,a.precio=b.precio,a.tipo=b.tipo},a.update=function(){a.producto=b.get({id:a.id},function(){a.producto.name=a.name,a.producto.precio=a.precio,a.producto.tipo=a.tipo,a.producto.$update(function(){a.id="",a.name="",a.precio="",a.tipo="cocina",a.editing=!1})})},a.cancelar=function(){a.id="",a.name="",a.precio="",a.tipo="cocina",a.editing=!1},a.$on("$destroy",function(){c.unsyncUpdates("producto")})}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("productos",{url:"/productos",templateUrl:"app/productos/productos.html",controller:"ProductosCtrl"})}]),angular.module("posApp").controller("ReportesCtrl",["$scope","$http","$filter","Auth","$state","$modal","$timeout","Orden","Producto","User",function(a,b,c,d,e,f,g,h,i,j){d.isLoggedIn(function(a){a||e.go("login")}),a.productos=i.query(),a.usuarios=j.query(),a.producto={hide:!0,text:"Todos"},a.usuario={hide:!0,text:"Todos"},a.numeroPedidos=0,a.results={},a.ordenes=[],a.productosVendidos=[],a.general=[],a.desde={today:new Date,status:{opened:!1}},a.hasta={today:new Date,status:{opened:!1}},a.ver=function(a){f.open({templateUrl:"verOrden.html",controller:"verCtrl",resolve:{orden:function(){return a}}})},a["delete"]=function(a){f.open({templateUrl:"deleteOrden.html",controller:"deleteCtrl",resolve:{orden:function(){return a}}})},a.selectProduct=function(b){a.producto.text=b.name,a.producto.hide=!0},a.selectUser=function(b){a.usuario.text=b.name,a.usuario.hide=!0},a.open=function(b){"desde"==b.currentTarget.name&&(a.desde.status={opened:!0}),"hasta"==b.currentTarget.name&&(a.hasta.status={opened:!0})},a.getPedidos=function(b,c){a.loading=!0,h.getRange({desde:b.getTime(),hasta:c.getTime()},function(b){a.ordenes=[],a.numeroPedidos=b.length;var c=0,d=0,e=0,f=0,g=0,h=0,i=0;b.map(function(b){"cerrada"==b.status&&("Todos"==a.usuario.text&&"Todos"==a.producto.text&&(b.productos.map(function(a){"cocina"==a.tipo?(f++,d+=a.precio*a.cantidad):(g++,e+=a.precio*a.cantidad)}),c+=b.total,h++,a.ordenes.push(b),console.log("if #1")),"Todos"!=a.usuario.text&&"Todos"==a.producto.text&&b.usuario.name==a.usuario.text&&(b.productos.map(function(a){"cocina"==a.tipo?(f++,d+=a.precio*a.cantidad):(g++,e+=a.precio*a.cantidad)}),c+=b.total,h++,a.ordenes.push(b),console.log("if #2")),"Todos"==a.usuario.text&&"Todos"!=a.producto.text&&b.productos.map(function(i){a.producto.text==i.name&&("cocina"==i.tipo?(f++,d+=i.precio*i.cantidad):(g++,e+=i.precio*i.cantidad),c+=b.total,h++,a.ordenes.push(b),console.log("if #3"))}),"Todos"!=a.usuario.text&&"Todos"!=a.producto.text&&b.productos.map(function(i){b.usuario&&b.usuario.name==a.usuario.text&&i.name==a.producto.text&&("cocina"==i.tipo?(f++,d+=i.precio*i.cantidad):(g++,e+=i.precio*i.cantidad),c+=b.total,h++,a.ordenes.push(b),console.log("if #4"))}))}),a.results={total:c,totalCocina:d,totalBar:e,totalProductosCocina:f,totalProductosBar:g,totalOrdenes:h,totalOrdenesBorradas:i},a.loading=!1})}}]),angular.module("posApp").controller("ReportesCtrl",["$scope","$http","$filter","Auth","$state","$modal","$timeout",function(a,b,c,d,e,f,g){d.isLoggedIn(function(a){a||e.go("login")}),a.ordenes=[],a.user="todos",a.productoField="todos",a.cargando=!0,b.get("/api/ordenes/all").then(function(b){a.data=b.data,a.cargando=!1}),b.get("/api/productos").success(function(b){a.productos=b}),b.get("/api/users").success(function(b){a.usuarios=b}),a.change=function(b){a.productoField=b,a.search()},a.ver=function(a){f.open({templateUrl:"verOrden.html",controller:"verCtrl",resolve:{orden:function(){return a}}})},a.today=function(){a.desde=new Date,a.hasta=new Date},a.time=function(){a.desdeTime="00:00",a.hastaTime="23:59"},a.today(),a.time(),a.desde.status={opened:!1},a.hasta.status={opened:!1},a.open=function(b){"desde"==b.currentTarget.name&&(a.desde.status={opened:!0}),"hasta"==b.currentTarget.name&&(a.hasta.status={opened:!0})},a.search=function(){var b=c("date")(a.desde,"MM/dd/yyyy"),d=c("date")(a.hasta,"MM/dd/yyyy"),e=a.desdeTime,f=a.hastaTime,g=b+" "+e,h=d+" "+f;g=new Date(g),h=new Date(h);var i=0,j=0,k=0,l=0;a.ordenes=[],$.each(a.data,function(b,c){c.fecha>=g.getTime()&&c.fecha<=h.getTime()&&("cerrado"==c.status||"cerrada"==c.status)&&("todos"==a.user?$.each(c.productos,function(b,c){if("todos"==a.productoField){if("cocina"==c.tipo){var d=c.precio*c.cantidad;i+=d}if("bar"==c.tipo){var e=c.precio*c.cantidad;j+=e}}else if(c.name==a.productoField){var f=c.precio*c.cantidad;k+=c.cantidad,l+=f}}):c.usuario.name==a.user&&$.each(c.productos,function(b,c){if("todos"==a.productoField){if("cocina"==c.tipo){var d=c.precio*c.cantidad;i+=d}if("bar"==c.tipo){var e=c.precio*c.cantidad;j+=e}}else if(c.name==a.productoField){var f=c.precio*c.cantidad;k+=c.cantidad,l+=f}}))}),a.cantidadTotalProducto=k,a.productoTotal=l,a.cocinaTotal=i,a.barTotal=j},a.dateOptions={formatYear:"yy",startingDay:1},a.format="dd/MM/yyyy"}]),angular.module("posApp").controller("ReportesCtrl",["$scope","$http","$filter","Auth","$state","$modal","$timeout","Orden","Producto","User",function(a,b,c,d,e,f,g,h,i,j){d.isLoggedIn(function(a){a||e.go("login")}),a.productos=i.query(),a.usuarios=j.query(),a.producto={hide:!0,text:"Todos"},a.usuario={hide:!0,text:"Todos"},a.numeroPedidos=0,a.results={},a.ordenes=[],a.productosVendidos=[],a.general=[],a.orden_id="",a.isActiveTickets=!1,a.isActiveVentas=!1,a.totalVentas=0,a.desde={today:new Date,status:{opened:!1}},a.hasta={today:new Date,status:{opened:!1}},a.ver=function(a){f.open({templateUrl:"verOrden.html",controller:"verCtrl",resolve:{orden:function(){return a}}})},a["delete"]=function(a){f.open({templateUrl:"deleteOrden.html",controller:"deleteCtrl",resolve:{orden:function(){return a}}})},a.selectProduct=function(b){a.producto.text=b.name,a.producto.hide=!0},a.selectUser=function(b){a.usuario.text=b.name,a.usuario.hide=!0},a.open=function(b){"desde"==b.currentTarget.name&&(a.desde.status={opened:!0}),"hasta"==b.currentTarget.name&&(a.hasta.status={opened:!0})},a.getPedidos=function(b,c){h.getAmmountSales({desde:b.getTime(),hasta:c.getTime()},function(b){a.general=b;var c=0;a.general.forEach(function(a){c+=a.value}),a.totalVentas=c}),h.getOrdenesByRange({desde:b.getTime(),hasta:c.getTime()},function(b){a.ordenes=b}),h.getProductosVendidos({desde:b.getTime(),hasta:c.getTime()},function(b){a.productosVendidos=b}),a.isActiveVentas=!0},a.getOrden=function(b){h.getOrden({id:b},function(b){a.ordenes=b,a.orden_id="",a.isActiveTickets=!0})}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("reportes",{url:"/reportes",templateUrl:"app/reportes/reportes.html",controller:"ReportesCtrl"})}]),angular.module("posApp").controller("TicketCtrl",["$scope","Counter","$interval","Auth","$state","$stateParams","$http",function(a,b,c,d,e,f,g){d.isLoggedIn(function(a){a||e.go("login")}),a.orden_id=f.id,g.get("/api/ordenes/"+a.orden_id).then(function(b){a.orden=b.data,console.log(a.orden),a.calculateTotal=function(){for(var b=0,c=0;c<a.orden.productos.length;c++){var d=a.orden.productos[c].precio*a.orden.productos[c].cantidad;b+=d}return b},a.calculatePendiente=function(){for(var b=0,c=0,d=0;d<a.orden.productos.length;d++){var e=a.orden.productos[d].pagados*a.orden.productos[d].precio,f=a.orden.productos[d].precio*a.orden.productos[d].cantidad;c+=e,b+=f}return b-c},a.aplicarPropina=function(){a.totalPropina=.1*a.calculatePendiente(),a.totalWithPropina=a.totalPropina+a.calculatePendiente()},a.aplicarPropina(),window.print()})}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("ticket",{url:"/ticket/:id",templateUrl:"app/ticket/ticket.html",controller:"TicketCtrl"})}]),angular.module("posApp").controller("UsuariosCtrl",["$scope","User","Auth","socket","$state",function(a,b,c,d,e){c.isLoggedIn(function(a){a||e.go("login")}),a.editing=!1,a.tipo="administrador",a.usuarios=b.query(),d.syncUpdates("user",a.usuarios),a.add=function(){if(a.name&&a.password){var b={name:a.name,rut:a.rut,password:a.password,role:a.tipo};c.createUser(b,function(){a.name="",a.rut="",a.tipo="",a.password=""})}else alert("Completa el formulario antes de ingresar un Usuario")},a.edit=function(b){a.editing=!0,a.id=b._id,a.name=b.name,a.rut=b.rut,a.tipo=b.role,a.password=b.password},a.update=function(){a.user=b.get({id:a.id},function(){a.user.name=a.name,a.user.rut=a.rut,a.user.role=a.tipo,a.user.password=a.password,a.user.$update(function(){a.id="",a.name="",a.rut="",a.tipo="administrador",a.password="",a.editing=!1})})},a.cancelar=function(){a.id="",a.name="",a.rut="",a.tipo="administrador",a.password="",a.editing=!1},a["delete"]=function(c){b.remove({id:c._id}),a.usuarios.splice(this.$index,1)},a.$on("$destroy",function(){d.unsyncUpdates("producto")})}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("usuarios",{url:"/usuarios",templateUrl:"app/usuarios/usuarios.html",controller:"UsuariosCtrl"})}]),angular.module("posApp").service("Orden",["$resource",function(a){return a("/api/ordenes/:id",{id:"@_id",desde:"@desde",hasta:"@hasta"},{update:{method:"PUT"},getAll:{method:"GET",url:"/api/ordenes/all",isArray:!0},getOrdenesByRange:{method:"GET",url:"/api/ordenes/:desde/:hasta",isArray:!0},getProductosVendidos:{method:"GET",url:"/api/ordenes/productos/:desde/:hasta",isArray:!0},getAmmountSales:{method:"GET",url:"/api/ordenes/ventas/:desde/:hasta",isArray:!0},getOrden:{method:"GET",url:"/api/ordenes/orden/especific/:id",isArray:!0}})}]),angular.module("posApp").service("Producto",["$resource",function(a){return a("/api/productos/:id",{id:"@_id"},{update:{method:"PUT"}})}]),angular.module("posApp").factory("Auth",["$http","User","$cookies","$q",function(a,b,c,d){var e=function(a){return angular.isFunction(a)?a:angular.noop},f={};return c.get("token")&&(f=b.get()),{login:function(g,h){return a.post("/auth/local",{rut:g.rut,password:g.password}).then(function(a){return c.put("token",a.data.token),f=b.get(),f.$promise}).then(function(a){return e(h)(null,a),a})["catch"](function(a){return this.logout(),e(h)(a.data),d.reject(a.data)}.bind(this))},logout:function(){c.remove("token"),f={}},createUser:function(a,c){return b.save(a,function(b){return e(c)(null,a)},function(a){return this.logout(),e(c)(a)}.bind(this)).$promise},changePassword:function(a,c,d){return b.changePassword({id:f._id},{oldPassword:a,newPassword:c},function(){return e(d)(null)},function(a){return e(d)(a)}).$promise},getCurrentUser:function(a){if(0===arguments.length)return f;var b=f.hasOwnProperty("$promise")?f.$promise:f;return d.when(b).then(function(b){return e(a)(b),b},function(){return e(a)({}),{}})},isLoggedIn:function(a){return 0===arguments.length?f.hasOwnProperty("role"):this.getCurrentUser(null).then(function(b){var c=b.hasOwnProperty("role");return e(a)(c),c})},isAdmin:function(a){return 0===arguments.length?"administrador"===f.role:this.getCurrentUser(null).then(function(b){var c="administrador"===b.role;return e(a)(c),c})},getRole:function(a){return 0===arguments.length?f.role:this.getCurrentUser(null).then(function(b){var c=b.role;return e(a)(c),c})},getToken:function(){return c.get("token")}}}]),angular.module("posApp").factory("User",["$resource",function(a){return a("/api/users/:id/:controller",{id:"@_id"},{changePassword:{method:"PUT",params:{controller:"password"}},get:{method:"GET",params:{id:"me"}},getByName:{method:"GET",url:"/api/users/specific/:id"},update:{method:"PUT"}})}]),angular.module("posApp").service("Counter",["$resource",function(a){return a("/api/counter/:id",{id:"@_id"},{update:{method:"PUT"}})}]),angular.module("posApp").directive("footer",function(){return{templateUrl:"components/footer/footer.html",restrict:"E",link:function(a,b){b.addClass("footer")}}}),angular.module("posApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirmar",html:"<p>Estas seguro que quieres borrar la orden # <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Borrar",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancelar",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("posApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}}),angular.module("posApp").controller("NavbarCtrl",["$scope","Auth",function(a,b){a.menu=[{title:"Caja",state:"caja",auth:[{role:"administrador"},{role:"caja"}]},{title:"Ventas",state:"main",auth:[{role:"administrador"},{role:"caja"},{role:"mesero"}]},{title:"Ordenes",state:"ordenes",auth:[{role:"administrador"},{role:"caja"},{role:"mesero"}]},{title:"Productos",state:"productos",auth:[{role:"administrador"}]},{title:"Usuarios",state:"usuarios",auth:[{role:"administrador"}]},{title:"Visor de Cocina",state:"cocina",auth:[{role:"administrador"},{role:"cocina"}]},{title:"Visor de Bar",state:"bar",auth:[{role:"administrador"},{role:"bar"}]},{title:"Reportes",state:"reportes",auth:[{role:"administrador"}]},{title:"Configuracion",state:"config",auth:[{role:"administrador"}]}],a.getRole=b.getRole,a.isCollapsed=!0,a.isLoggedIn=b.isLoggedIn,a.isAdmin=b.isAdmin,a.getCurrentUser=b.getCurrentUser,a.check=function(a,b){return _.find(a,{role:b})?!0:!1}}]),angular.module("posApp").directive("navbar",function(){return{templateUrl:"components/navbar/navbar.html",restrict:"E",controller:"NavbarCtrl"}}),angular.module("posApp").factory("socket",["socketFactory",function(a){var b=io("http://pos.kangurubar.cl:8000",{path:"/socket.io-client"}),c=a({ioSocket:b});return{socket:c,syncUpdates:function(a,b,d){d=d||angular.noop,c.on(a+":save",function(a){var c=_.find(b,{_id:a._id}),e=b.indexOf(c),f="created";c?(b.splice(e,1,a),f="updated"):b.push(a),d(f,a,b)}),c.on(a+":remove",function(a){var c="deleted";_.remove(b,{_id:a._id}),d(c,a,b)})},unsyncUpdates:function(a){c.removeAllListeners(a+":save"),c.removeAllListeners(a+":remove")}}}]),angular.module("posApp").run(["$templateCache",function(a){a.put("app/account/login/login.html",'<div class=container><div class="panel panel-default" style=margin-top:100px><h3 class=text-center>INICIA SESION</h3><hr><div class=panel-body><div class=container-fluid><div class=row><div class=col-lg-12><form class=form name=form ng-submit=login(form) novalidate><div class=form-group><label>R.U.T</label><input type=rut name=rut class=form-control ng-model=user.rut required></div><div class=form-group><label>Contraseña</label><input type=password name=password class=form-control ng-model=user.password required></div><div class="form-group has-error"><p class=help-block ng-show="form.rut.$error.required && form.password.$error.required && submitted">Please enter your rut and password.</p><p class=help-block ng-show="form.rut.$error.rut && submitted">Please enter a valid email.</p><p class=help-block>{{ errors.other }}</p></div><div class=text-center><button class="btn btn-primary btn btn-login" type=submit>INGRESAR</button></div></form></div></div></div></div></div></div><footer></footer>'),a.put("app/archivo/archivo.html",'<navbar></navbar><div class=container><h3 class=text-center>ARCHIVO</h3><hr><div class=row><div class="col-lg-12 text-center"><div class="panel panel-default"><div class=panel-heading><input ng-model=busqueda.orden_id style=height:55px;font-size:26px class="form-control"></div><div class=panel-body><div class=container-fluid><div class=row><div class=text-center ng-if="cargando == true"><img src=assets/images/loading_spinner.69f5ee8d.gif width=50></div><div ng-if="orden.status == \'Borrado\'" ng-repeat="orden in ordenes |  filter:busqueda" class="col-lg-6 col-lg-12"><div class="panel panel-default"><div class=panel-heading><div class=container-fluid><div class=row style=font-size:26px><div class="col-lg-4 col-xs-4 text-left"># {{orden.orden_id}}</div><div class="col-lg-4 col-xs-4 text-center">{{orden.usuario.name}}</div><div class="col-lg-4 col-xs-4 text-right">{{productCount(orden)}}</div></div></div></div><div class=panel-body><div class=container-fluid><button aria-hidden=true ng-click=ver(orden) style="font-size: 30px" class="btn-lg btn-primary glyphicon glyphicon-search"></button></div></div></div></div></div></div></div></div></div></div></div><footer></footer><script type=text/ng-template id=verOrden.html><div class="modal-header">\n        <h3 class="modal-title">Detalles de orden # {{orden.orden_id}}</h3>\n    </div>\n    <div class="modal-body">\n      <div><b>Estado de la Orden:</b> <span ng-class="{borrado: orden.status == \'Borrado\', cerrado: orden.status == \'cerrada\'}">{{orden.status}}</span></div>\n      <div><b>Orden ingresada por:</b> {{orden.usuario.name}}</div>\n      <div><b>Fecha:</b> {{ orden.fecha | date : \'d-M-yyyy - h:mm:ss a\' }}</div>\n      <div><b>Tipo de orden:</b> {{orden.tipo}}</div>\n      <div><b>Mesa:</b> {{orden.mesa}}</div>      \n      <div><b>Observacion:</b> {{ orden.observacion}}</div>\n      <hr>\n      <div class="table-responsive">\n        <table class="table">\n          <thead>\n            <th class="text-left">Pagado</th>\n            <th>Cantidad</th>\n            <th>Producto</th>\n            <th>Precio</th>\n            <th class="text-center">Servido</td>\n          </thead>\n          <tr ng-repeat="producto in orden.productos">\n            <td class="text-left"><span ng-if="producto.pagado == false">{{showPagados(producto)}}</span><span ng-if="producto.pagado == true"  class="glyphicon glyphicon-ok"></span></td>\n            <td>{{producto.cantidad}}</td>\n            <td>{{producto.name}}</td>\n            <td>{{producto.precio * producto.cantidad | currency }}</td>\n            <td ng-if="producto.servido == true" class="text-center"><span class="glyphicon glyphicon-ok"></span></td>\n          </tr>\n        </table>\n      </div>\n      <hr>\n      <div class="text-center"><b>Subtotal:</b> {{calculateTotal()  | currency}}</div>\n      <div class="text-center"><b>Propina Sugerida (10%):</b> {{calculateTotal() * 0.10 | currency}}</div>\n      <div class="text-center"><b>Total:</b> {{calculateTotal() * 0.10 +  calculateTotal() | currency}}</div>\n    </div>\n    <div class="modal-footer">\n        <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>\n    </div></script>'),
a.put("app/bar/bar.html",'<navbar></navbar><div class=container><h3 class=text-center>VISOR DE BARRA</h3><hr><div class=row><div class="col-lg-12 text-left"><div ng-repeat="orden in ordenes" ng-if=revisa(orden) class="orden col-lg-12 col-xs-12"><div class="panel panel-default"><div class=panel-heading><div class=container-fluid><div class=row><div class="col-lg-4 col-xs-4 text-left"><span style=font-size:20px><b># {{orden.orden_id}}</b></span></div><div class="col-lg-4 col-xs-4 text-center"><span style=font-size:20px><b>{{orden.usuario.name}}</b> | para {{orden.tipo}}</span></div><div class="col-lg-4 col-xs-4 text-right"><span style=font-size:20px>{{ orden.fechaEditado | date : \'h:mm:ss a\' }}</span></div></div></div></div><div class=panel-body><div ng-repeat="producto in orden.productos" class=productos><div ng-if="producto.tipo == \'bar\'" class=container-fluid><div class=row ng-hide="producto.servido == true"><div class="col-lg-2 col-xs-2 text-left"><span style=font-size:20px class=badge>{{producto.cantidad}}</span></div><div class="col-lg-5 col-xs-5 text-left"><span style=font-size:20px ng-if="producto.servido == false">{{producto.name}}</span> <span style=font-size:20px;text-decoration:line-through ng-if="producto.servido == true">{{producto.name}}</span></div><div class="col-lg-5 col-xs-5 text-right"><button aria-hidden=true ng-click="listo(orden, producto)" class="btn btn-success glyphicon glyphicon-ok"></button></div></div><div ng-if=producto.observacion ng-hide="producto.servido == true" class=well style="margin-top: 10px;font-size: 18px">{{producto.observacion}}</div></div></div></div></div></div></div></div></div><footer></footer>'),a.put("app/caja/caja.html",'<navbar></navbar><div class=container><h3 class=text-center>CAJA - ({{totalOrdenes}})</h3><hr><div class=row><div class="col-lg-12 text-center"><div class="panel panel-default"><div class=panel-heading><select ng-model=busqueda.usuario.name class=form-control><option value="">TODOS</option><option ng-repeat="usuario in usuarios" value={{usuario.name}}>{{usuario.name}}</option></select><input ng-model=busqueda.orden_id style=height:55px;font-size:26px class="form-control"></div><div class=panel-body><div class=container-fluid><div class=row><div ng-repeat="orden in ordenes |  filter:busqueda" ng-if=abierta(orden) class="col-lg-6 col-lg-12"><div class="panel panel-default"><div class=panel-heading><div class=container-fluid><div class=row style=font-size:24px><div class="col-lg-3 col-xs-3 text-left"># {{orden.orden_id}}</div><div class="col-lg-6 col-xs-6 text-center">{{orden.usuario.name}} - {{orden.mesa}}</div><div class="col-lg-3 col-xs-3 text-right">{{productCount(orden)}}</div></div></div></div><div class=panel-body><div class=container-fluid><button aria-hidden=true ng-click=edit(orden._id) style="font-size: 30px" class="btn-lg btn-success glyphicon glyphicon-pencil"></button> <button aria-hidden=true ng-click=ver(orden) style="font-size: 30px" class="btn-lg btn-primary glyphicon glyphicon-search"></button> <button aria-hidden=true ng-click=delete(orden) ng-if="orden.status != \'Borrado\'" style="font-size: 30px" class="btn-lg btn-danger glyphicon glyphicon-remove"></button> <button aria-hidden=true ng-click=pay(orden) ng-if="orden.status != \'Borrado\'" style="font-size: 30px" class="btn-lg btn-success glyphicon glyphicon-usd"></button> <button aria-hidden=true ng-click=divide(orden) ng-if="orden.status != \'Borrado\'" style="font-size: 30px" class="btn-lg btn-success glyphicon glyphicon-th-list"></button></div></div></div></div></div></div></div></div></div></div></div><footer></footer><script type=text/ng-template id=verOrden.html><div class="modal-header">\n    <h3 class="modal-title">Detalles de orden # {{orden.orden_id}}</h3>\n  </div>\n  <div class="modal-body">\n  <div class="row">\n  	<div class="col-lg-6">\n     <div><b>Orden ingresada por:</b> {{orden.usuario.name}}</div>\n    <div><b>Fecha:</b> {{ orden.fecha | date : \'d-M-yyyy - h:mm:ss a\' }}</div>\n    <div><b>Tipo de orden:</b> {{orden.tipo}}</div>\n    <div><b>Mesa:</b> {{orden.mesa}}</div> 		\n  	</div>\n  	<div class="col-lg-6 text-center">\n  		<button class="btn btn-primary" type="button" ng-click="print(orden._id)"><span class="glyphicon glyphicon-print"></span> Imprimir</button>\n  	</div>\n  </div>\n\n    <hr>\n    <div class="table-responsive">\n      <table class="table">\n        <thead>\n          <th class="text-left">Pagado</th>\n          <th>Cantidad</th>\n          <th>Producto</th>\n          <th>Precio</th>\n          <th class="text-center">Servido</td>\n        </thead>\n        <tr ng-repeat="producto in orden.productos">\n          <td class="text-left"><span ng-if="producto.pagado == false">{{showPagados(producto)}}</span><span ng-if="producto.pagado == true" class="glyphicon glyphicon-ok"></span></td>\n          <td>{{producto.cantidad}}</td>\n          <td>{{producto.name}}</td>\n          <td>{{producto.precio * producto.cantidad | currency }}</td>\n          <td ng-if="producto.servido == true" class="text-center"><span class="glyphicon glyphicon-ok"></span></td>\n        </tr>\n      </table>\n    </div>\n    <hr>\n    <div class="precioModal text-center"><b>Total:</b> {{calculateTotal() | currency}}\n      <hr><b>Por pagar:</b> {{calculatePendiente() | currency}}</div>\n    <hr>\n    <div><b>Historial de Modificaciones:</b></div>\n    <div class="table-responsive">\n      <table class="table">\n        <thead>\n          <th>Fecha</th>\n          <th>Observacion</th>\n          <th>Producto</th>\n        </thead>\n        <tr ng-repeat="o in orden.observaciones">\n          <td class="text-left">{{o.fecha | date : \'d-M-yyyy - h:mm:ss a\'}}</td>\n          <td class="text-left">{{o.observacion}}</td>\n          <td class="text-left">{{o.producto.name}}</td>\n        </tr>\n      </table>\n    </div>\n  </div>\n  <div class="modal-footer">    \n    <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>\n  </div></script><script type=text/ng-template id=payOrden.html><div class="modal-header">\n    <h3 class="modal-title">Pagar orden # {{orden.orden_id}}</h3>\n  </div>\n  <div class="modal-body">\n    <div class="container-fluid">\n      <div><b>Orden ingresada por:</b> {{orden.usuario.name}}</div>\n      <div><b>Fecha:</b> {{ orden.fecha | date : \'d-M-yyyy - h:mm:ss a\' }}</div>\n      <div><b>Tipo de orden:</b> {{orden.tipo}}</div>\n      <div><b>Mesa:</b> {{orden.mesa}}</div>\n      <hr>\n      <div class="table-responsive">\n        <table class="table">\n          <thead>\n            <th class="text-left">Pagado</th>\n            <th>Cantidad</th>\n            <th>Producto</th>\n            <th>Precio</th>\n            <th class="text-center">Servido</td>\n          </thead>\n          <tr ng-repeat="producto in orden.productos">\n            <td class="text-left"><span ng-if="producto.pagado == false">{{showPagados(producto)}}</span><span ng-if="producto.pagado == true" class="glyphicon glyphicon-ok"></span></td>\n            <td>{{producto.cantidad}}</td>\n            <td>{{producto.name}}</td>\n            <td>{{producto.precio * producto.cantidad | currency }}</td>\n            <td ng-if="producto.servido == true" class="text-center"><span class="glyphicon glyphicon-ok"></span></td>\n          </tr>\n        </table>\n        <hr>\n      </div>\n      <div class="precioModal text-right">\n        <div class="row">\n          <div class="col-lg-6 col-xs-6 text-left"><b>Por pagar:</b> {{calculatePendiente() | currency}}</div>\n          <div class="col-lg-6 col-xs-6"><b>Total:</b> {{calculatePendiente() | currency}}</div>\n        </div>\n        <div ng-if="propina == true"><b>Propina:</b> {{ totalPropina | currency }}</div>\n        <div ng-if="propina == true"><b>Total mas Propina:</b> {{ totalWithPropina | currency }}</div>\n        <div ng-if="descuento != 0"><b>Descuento ({{descuento}}%):</b> {{ totalDescuento | currency }}</div>\n        <div ng-if="descuento != 0"><b>TOTAL:</b> {{ totalMenosDescuento | currency }}</div>\n        <hr>\n      </div>\n    </div>\n    <div class="container-fluid">\n      <div class="row">\n        <div class="col-lg-12 col-xs-12 text-center">\n          <select class="form-control" ng-model="descuento" ng-change="aplicarDescuento(descuento)">\n            <option value="0">-- SIN DESCUENTO --</option>\n            <option value="5">5%</option>\n            <option value="10">10%</option>\n            <option value="15">15%</option>\n            <option value="20">20%</option>\n          </select>\n        </div>\n      </div>\n      <hr>\n      <div class="row">\n        <div class="col-lg-12 col-xs-12 text-center">\n          <input type="text" ng-model="data.ingreso" class="form-control" placeholder="calcular vuelto..." />\n        </div>\n      </div>\n      <div class="row">\n        <div class="col-lg-12 col-xs-12 text-right">\n          <br>\n          <label ng-if="data.ingreso > calculatePendiente()" class="precioModal">\n            Vuelto: {{data.ingreso - calculatePendiente() - totalPropina | currency}}\n          </label>\n        </div>\n      </div>\n      <hr/>\n      <div class="container-fluid">\n        <div class="row">\n          <div class="col-lg-12 col-xs-12 text-right">\n            <select ng-model="tipoPago" class="form-control">\n              <option value="efectivo">Efectivo</option>\n              <option value="debito">Debito</option>\n              <option value="credito">Credito</option>\n            </select>\n          </div>\n        </div>\n      </div>\n      <hr/>\n      <div class="container-fluid">\n        <div class="row">\n          <div class="col-lg-3 col-xs-3 text-right">\n            <label class="precioModal"><b>Propina:</b></label>\n          </div>\n          <div class="col-lg-9 col-xs-9 text-center">\n            <input type="text" ng-model="propinaPagada" class="form-control" />\n          </div>\n        </div>\n      </div>\n      <hr/>\n      <div class="container-fluid">\n        <div class="row">\n          <div class="col-lg-3 col-xs-3 text-right">\n            <label class="precioModal"><b># Boleta:</b></label>\n          </div>\n          <div class="col-lg-9 col-xs-9">\n            <input type="text" ng-model="numeroBoleta" class="form-control" />\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="modal-footer">\n    <div class="row">\n      <div class="col-lg-6 col-xs-6 text-left">\n        <button class="btn-lg btn-warning" type="button" ng-click="cerrar()">CERRAR</button>\n      </div>\n      <div class="col-lg-6 col-xs-6">\n        <button class="btn-lg btn-success" type="button" ng-click="pagar()">PAGAR</button>\n      </div>\n    </div>\n  </div></script><script type=text/ng-template id=divideOrden.html><div class="modal-header">\n    <h3 class="modal-title">Dividir Cuenta # {{o.orden_id}}</h3>\n  </div>\n  <div class="modal-body">\n    <div><b>Orden ingresada por:</b> {{o.usuario.name}}</div>\n    <div><b>Fecha:</b> {{ o.fecha | date : \'d-M-yyyy - h:mm:ss a\' }}</div>\n    <div><b>Tipo de orden:</b> {{o.tipo}}</div>\n    <div><b>Mesa:</b> {{o.mesa}}</div>\n    <hr>\n    <div class="table-responsive">\n      <table class="table">\n        <thead>\n          <th>Por Pagar</th>\n          <th>Producto</th>\n          <th>Precio</th>\n          <th>Pagar</th>\n        </thead>\n        <tr ng-repeat="producto in o.productos">\n          <td>{{producto.cantidad - producto.pagados}}</td>\n          <td>{{producto.name}}</td>\n          <td>{{producto.precio | currency }}</td>\n          <td>\n            <button class="btn btn-success" ng-click="pagar(producto)" ng-if="producto.pagados - producto.cantidad">\n              <span class="glyphicon glyphicon-plus"></span>\n            </button>\n            <button class="btn btn-danger" ng-click="revertir(producto)" ng-if="checkSubticket(producto)">\n              <span class="glyphicon glyphicon-minus"></span>\n            </button>\n          </td>\n        </tr>\n      </table>\n    </div>\n    <hr>\n    <div class="table-responsive">\n      <table class="table">\n        <thead>\n          <th>Cantidad</th>\n          <th>Producto</th>\n          <th>Precio</th>\n        </thead>\n        <tr ng-repeat="item in subticket">\n          <td>{{item.cantidad}}</td>\n          <td>{{item.name}}</td>\n          <td>{{item.precio * item.cantidad | currency }}</td>\n        </tr>\n      </table>\n    </div>\n    <hr>\n    <div class="precioModal text-center"><b>Total Subcuenta:</b> {{calculateTotal() | currency}}</div>\n    <div class="precioModal text-center"><b>Propina:</b> {{propina = calculateTotal() * 0.10 | currency}}</div>\n    <div class="precioModal text-center"><b>Total mas Propina:</b> {{ calculateTotal() + propina | currency }}</div>\n    <hr>\n    <div class="row">\n      <div class="col-lg-12 col-xs-12 text-center">\n        <input type="text" ng-model="data.ingreso" class="form-control" placeholder="Vuelto" />\n      </div>\n    </div>\n    <div class="row">\n      <div class="col-lg-12 col-xs-12 text-right">\n        <br>\n        <label ng-if="data.ingreso > calculateTotal()" class="precioModal">\n          Vuelto: {{data.ingreso - calculateTotal() - propina | currency}}\n        </label>\n      </div>\n    </div>\n  </div>\n  <div class="modal-footer">\n    <div class="text-center">\n      <button class="btn-lg btn-warning" type="button" ng-click="cerrar()">CERRAR</button>\n    </div>\n  </div></script><script type=text/ng-template id=deleteOrden.html><div class="modal-header">\n    <h3 class="modal-title">Borrar Orden: # {{orden.orden_id}}</h3>\n  </div>\n  <div class="modal-body">\n    <p><b>Esta seguro que desea borrar la orden #: {{orden.orden_id}}?</b></p>\n    <h4>Observación:</h4>\n    <textarea class="form-control" ng-model="observacion"></textarea>\n  </div>\n  <div class="modal-footer">\n    <div class="text-center">\n      <button class="btn-lg btn-danger" type="button" ng-if="observacion != \'\'" ng-click="borrar()">Borrar</button>\n    </div>\n  </div></script>'),a.put("app/cocina/cocina.html",'<navbar></navbar><div class=container><h3 class=text-center>VISOR DE COCINA</h3><hr><div class=row><div class="col-lg-12 text-left"><div ng-repeat="orden in ordenes" ng-if=revisa(orden) class="col-lg-12 col-xs-12"><div class="panel panel-default"><div class=panel-heading><div class=container-fluid><div class=row><div class="col-lg-4 col-xs-4 text-left"><span style=font-size:20px><b># {{orden.orden_id}}</b></span></div><div class="col-lg-4 col-xs-4 text-center"><span style=font-size:20px><b>{{orden.usuario.name}}</b> | para {{orden.tipo}}</span></div><div class="col-lg-4 col-xs-4 text-right"><span style=font-size:20px>{{ orden.fechaEditado | date : \'h:mm:ss a\' }}</span></div></div></div></div><div class=panel-body><div ng-repeat="producto in orden.productos" class=productos><div ng-if="producto.tipo == \'cocina\'" class=container-fluid><div class=row ng-hide="producto.servido == true"><div class="col-lg-2 col-xs-2 text-left"><span style=font-size:20px class=badge>{{producto.cantidad}}</span></div><div class="col-lg-5 col-xs-5 text-left"><span style=font-size:20px ng-if="producto.servido == false"><a ng-click="mostrarObservacion($index, producto)">{{producto.name}}</a></span><span style=font-size:20px;text-decoration:line-through ng-if="producto.servido == true">{{producto.name}}</span></div><div class="col-lg-5 col-xs-5 text-right"><button aria-hidden=true ng-click="listo(orden, producto)" class="btn btn-success glyphicon glyphicon-ok"></button></div></div><div ng-if=producto.observacion ng-hide="producto.servido == true" class=well style="margin-top: 10px;font-size: 18px">{{producto.observacion}}</div></div></div></div></div></div></div></div></div><footer></footer>'),a.put("app/config/config.html",'<navbar></navbar><div class=container><h3 class=text-center>CONFIGURACIONES</h3><hr><div class=container-fluid><div class=row><div class=col-lg-12><label>Contador de Ordenes:</label><span style=padding-left:10px><b>{{notification}}</b></span> <input ng-model=orden_id class=form-control><br><button class="btn btn-primary" ng-click=updateCounter(showNotification)>ACTUALIZAR</button></div></div></div></div><footer></footer>'),a.put("app/editar/editar.html",'<navbar></navbar><div class=container><h3 class=text-center>ORDEN # : {{data.orden_id}}</h3><hr><div class=row><div class=col-lg-6><div class="panel panel-default"><div class=panel-body><div class=row><div class=col-lg-4>Tipo de Orden:</div><div class=col-lg-8><select name=tipo ng-model=data.tipo class=form-control><option value=servir>Servir</option><option value=llevar>Llevar</option></select></div></div><div ng-if="data.tipo == \'servir\'" class=row><div class=col-lg-4>Mesa:</div><div class=col-lg-8><select name=mesa ng-model=data.mesa class=form-control><option value=1>1</option><option value=2>2</option><option value=3>3</option><option value=4>4</option><option value=5>5</option><option value=6>6</option><option value=7>7</option><option value=8>8</option><option value=9>9</option><option value=10>10</option><option value=11>11</option><option value=12>12</option><option value=13>13</option><option value=14>14</option><option value=15>15</option><option value=16>16</option><option value=17>17</option><option value=18>18</option><option value=19>19</option><option value=20>20</option><option value=21>21</option><option value=22>22</option><option value=23>23</option><option value=24>24</option><option value=25>25</option><option value=26>26</option><option value=27>27</option><option value=28>28</option><option value=29>29</option><option value=30>30</option><option value=31>31</option><option value=32>32</option><option value=33>33</option><option value=34>34</option><option value=35>35</option><option value=36>36</option><option value=37>37</option><option value=38>38</option><option value=39>39</option><option value=40>40</option><option value=41>41</option><option value=42>42</option><option value=43>43</option><option value=44>44</option><option value=45>45</option><option value=46>46</option><option value=47>47</option><option value=48>48</option><option value=49>49</option><option value=50>50</option><option value=51>51</option><option value=52>52</option><option value=53>53</option><option value=54>54</option><option value=55>55</option><option value="br 1">br 1</option><option value="br 2">br 2</option><option value="br 3">br 3</option><option value="br 4">br 4</option><option value="br 5">br 5</option><option value="br 6">br 6</option><option value="br 7">br 7</option><option value="br 8">br 8</option><option value="br 9">br 9</option><option value="br 10">br 10</option></select></div></div><hr><div ng-repeat="item in ticket" class=container-fluid style=font-size:18px><div class=row><div class="col-lg-2 col-xs-2"><span class=badge style=font-size:18px>{{item.cantidad}}</span></div><div class="col-lg-4 col-xs-4 text-left">{{item.name}}</div><div class="col-lg-3 col-xs-4">{{item.precio * item.cantidad | currency}}</div><div class="col-lg-3 col-xs-2 text-rigth"><button aria-hidden=true ng-if="item.servido==false || userRole == \'administrador\'" ng-click=delete(item) class="btn-xs btn-danger glyphicon glyphicon-remove"></button> <button aria-hidden=true ng-if="item.servido==false || userRole == \'administrador\'" ng-click=addToTicket(item) class="btn-xs btn-success glyphicon glyphicon-plus"></button> <button aria-hidden=true ng-click=mostrarObservacion(item) class="btn-xs btn-warning glyphicon glyphicon-search"></button></div></div><div ng-if=item.showObservacion><textarea class=form-control ng-model=item.observacion style=margin-top:10px></textarea></div><hr></div><div class=container-fluid><div class=row><div class="col-lg-12 text-center" style=font-size:18px>{{ calculateTotal() | currency }}</div></div><div class=row><div class="col-lg-12 text-center"><hr><button ng-click=updateTicket() class="btn-lg btn-success">ACTUALIZAR</button></div></div></div></div></div></div><div class=col-lg-6><div class="panel panel-default"><div class="panel-heading text-center"><input ng-model=producto class=form-control style="height:55px;font-size:26px"></div><div class=panel-body><div class=container-fluid><div class=row><div style="margin-bottom:10px;padding-top:10px;padding-bottom:10px;font-size:24px;white-space: normal" ng-repeat="producto in productos | filter:producto" ng-click=addToTicket(producto) class="col-lg-12 col-xs-12 btn btn-default">{{producto.name}}</div></div></div></div></div></div></div></div><footer></footer><script type=text/ng-template id=deleteProducto.html><div class="modal-header">\n        <h3 class="modal-title">Borrar Producto de la Orden</h3>\n    </div>    \n    <div class="modal-body">\n      <p><b>Esta seguro que desea borrar este producto {{item.name}}?</b></p>\n      <h4>Detalle de modificaci&oacute;n:</h4>\n      <textarea class="form-control" ng-model="observacion"></textarea>\n    </div>\n    <div class="modal-footer">\n        <div class="text-center">\n        <button class="btn-lg btn-danger" type="button" ng-if="showDeleteButton()" ng-click="borrar()">Borrar</button>\n        </div>\n    </div></script>'),a.put("app/insight/insight.html",'<navbar></navbar><div class=container><h3 class=text-center>INSIGHTS:</h3><hr><table datatable="" dt-options=dtOptions dt-columns=dtColumns class="table table-striped table-bordered"></table></div><footer></footer>'),a.put("app/main/main.html",'<navbar></navbar><div class=container><h3 class=text-center>VENTAS</h3><hr><div class=row><div class=col-lg-6><div class="panel panel-default"><div class=panel-body><div class=row><div class=col-lg-4>Usuario:</div><div class=col-lg-8><select ng-model=data.u class=form-control ng-disabled="data.role == \'mesero\'"><option ng-repeat="usuario in usuarios" ng-value=usuario.name>{{usuario.name}}</option></select></div></div><div class=row><div class=col-lg-4>Tipo de Orden:</div><div class=col-lg-8><select name=tipo ng-model=data.tipo class=form-control><option value=servir>Servir</option><option value=llevar>Llevar</option></select></div></div><div ng-if="data.tipo == \'servir\'" class=row><div class=col-lg-4>Mesa:</div><div class=col-lg-8><select name=mesa ng-model=data.mesa class=form-control><option value=1>1</option><option value=2>2</option><option value=3>3</option><option value=4>4</option><option value=5>5</option><option value=6>6</option><option value=7>7</option><option value=8>8</option><option value=9>9</option><option value=10>10</option><option value=11>11</option><option value=12>12</option><option value=13>13</option><option value=14>14</option><option value=15>15</option><option value=16>16</option><option value=17>17</option><option value=18>18</option><option value=19>19</option><option value=20>20</option><option value=21>21</option><option value=22>22</option><option value=23>23</option><option value=24>24</option><option value=25>25</option><option value=26>26</option><option value=27>27</option><option value=28>28</option><option value=29>29</option><option value=30>30</option><option value=31>31</option><option value=32>32</option><option value=33>33</option><option value=34>34</option><option value=35>35</option><option value=36>36</option><option value=37>37</option><option value=38>38</option><option value=39>39</option><option value=40>40</option><option value=41>41</option><option value=42>42</option><option value=43>43</option><option value=44>44</option><option value=45>45</option><option value=46>46</option><option value=47>47</option><option value=48>48</option><option value=49>49</option><option value=50>50</option><option value=51>51</option><option value=52>52</option><option value=53>53</option><option value=54>54</option><option value=55>55</option><option value="br 1">br 1</option><option value="br 2">br 2</option><option value="br 3">br 3</option><option value="br 4">br 4</option><option value="br 5">br 5</option><option value="br 6">br 6</option><option value="br 7">br 7</option><option value="br 8">br 8</option><option value="br 9">br 9</option><option value="br 10">br 10</option></select></div></div><hr><div ng-repeat="item in ticket" class=container-fluid style=font-size:18px><div class=row><div class="col-lg-2 col-xs-2"><span class=badge style=font-size:18px>{{item.cantidad}}</span></div><div class="col-lg-4 col-xs-4 text-left">{{item.name}}</div><div class="col-lg-3 col-xs-4">{{item.precio * item.cantidad | currency}}</div><div class="col-lg-3 col-xs-2 text-rigth"><button aria-hidden=true ng-click=deleteItem(item) class="btn-xs btn-danger glyphicon glyphicon-remove"></button> <button aria-hidden=true ng-click=addToTicket(item) class="btn-xs btn-success glyphicon glyphicon-plus"></button> <button aria-hidden=true ng-click=mostrarObservacion(item) class="btn-xs btn-warning glyphicon glyphicon-search"></button></div></div><div ng-if=item.showObservacion><textarea class=form-control ng-model=item.observacion style=margin-top:10px></textarea></div><hr></div><div class=container-fluid><div class=row><div class="col-lg-12 text-center" style=font-size:18px>{{ calculateTotal() | currency }}</div></div><div class=row><div class="col-lg-12 text-center"><hr><button ng-click=addTickeToQueue() class="btn-lg btn-success">INGRESAR</button></div></div></div></div></div></div><div class=col-lg-6><div class="panel panel-default"><div class="panel-heading text-center"><input ng-model=producto class=form-control style="height:55px;font-size:26px"></div><div class=panel-body><div class=container-fluid><div class=row><div style="margin-bottom:10px;padding-top:10px;padding-bottom:10px;font-size:24px;white-space: normal" ng-repeat="producto in productos | filter:producto" ng-click=addToTicket(producto) class="col-lg-12 col-xs-12 btn btn-default">{{producto.name}}</div></div></div></div></div></div></div></div><footer></footer>'),a.put("app/ordenes/ordenes.html",'<navbar></navbar><div class=container><h3 class=text-center>ORDENES</h3><hr><div class=row><div class="col-lg-12 text-center"><div class="panel panel-default"><div class=panel-heading><input ng-model=busqueda.orden_id style=height:55px;font-size:26px class="form-control"></div><div class=panel-body><div class=container-fluid><div class=row><div ng-repeat="orden in ordenes |  filter:busqueda" class="col-lg-6 col-lg-12"><div class="panel panel-default"><div class=panel-heading><div class=container-fluid><div class=row style=font-size:26px><div class="col-lg-4 col-xs-4 text-left"># {{orden.orden_id}}</div><div class="col-lg-4 col-xs-4 text-center">{{orden.mesa}}</div><div class="col-lg-4 col-xs-4 text-right">{{productCount(orden)}}</div></div></div></div><div class=panel-body><div class=container-fluid><button aria-hidden=true ng-click=edit(orden._id) style="font-size: 30px" class="btn-lg btn-success glyphicon glyphicon-pencil"></button> <button aria-hidden=true ng-click=ver(orden) style="font-size: 30px" class="btn-lg btn-primary glyphicon glyphicon-search"></button></div></div></div></div></div></div></div></div></div></div></div><footer></footer><script type=text/ng-template id=verOrden.html><div class="modal-header">\n        <h3 class="modal-title">Detalles de orden # {{orden.orden_id}}</h3>\n    </div>\n    <div class="modal-body">\n      <div><b>Orden ingresada por:</b> {{orden.usuario.name}}</div>\n      <div><b>Fecha:</b> {{ orden.fecha | date : \'d-M-yyyy - h:mm:ss a\' }}</div>\n      <div><b>Tipo de orden:</b> {{orden.tipo}}</div>\n      <div><b>Mesa:</b> {{orden.mesa}}</div>\n      <hr>\n      <div class="table-responsive">\n        <table class="table">\n          <thead>\n            <th class="text-left">Pagado</th>\n            <th>Cantidad</th>\n            <th>Producto</th>\n            <th>Precio</th>\n            <th class="text-center">Servido</td>\n          </thead>\n          <tr ng-repeat="producto in orden.productos">\n            <td class="text-left"><span ng-if="producto.pagado == false">{{showPagados(producto)}}</span><span ng-if="producto.pagado == true"  class="glyphicon glyphicon-ok"></span></td>\n            <td>{{producto.cantidad}}</td>\n            <td>{{producto.name}}</td>\n            <td>{{producto.precio * producto.cantidad | currency }}</td>\n            <td ng-if="producto.servido == true" class="text-center"><span class="glyphicon glyphicon-ok"></span></td>\n          </tr>\n        </table>\n      </div>\n      <hr>\n      <div class="text-center" style="font-size:18px;"><b>Subtotal:</b> {{calculatePendiente()  | currency}}</div>\n      <div class="text-center" style="font-size:18px;"><b>Propina Sugerida (10%):</b> {{calculatePendiente() * 0.10 | currency}}</div>\n      <div class="text-center" style="font-size:18px;"><b>Total:</b> {{calculatePendiente() * 0.10 +  calculatePendiente() | currency}}</div>\n    </div>\n    <div class="modal-footer">\n        <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>\n    </div></script>'),a.put("app/productos/productos.html",'<navbar></navbar><div class=container><h3 class=text-center>PRODUCTOS</h3><hr><div class=row><div class=col-lg-4><div class="panel panel-default"><div class=panel-body><form id=producto-form><div class=row><div class=col-lg-12><div id=error-message></div><label style=margin-top:10px>Nombre:</label><input name=nombre class=form-control ng-model="name"><label style=margin-top:10px>Precio:</label><input name=precio class=form-control ng-model="precio"><label style=margin-top:10px>Tipo:</label><select name=tipo class=form-control ng-model=tipo><option value=cocina>Cocina</option><option value=bar>Bar</option></select></div></div><div class=row><div class="col-lg-12 text-right"><button style=margin-top:20px ng-click=cancelar() ng-if="editing == true" class="btn btn-danger">CANCELAR</button> <button style=margin-top:20px ng-if="editing == true" ng-click=update() class="btn btn-success">ACTUALIZAR</button> <button style=margin-top:20px ng-if="editing != true" ng-click=add() class="btn btn-primary">INGRESAR</button></div></div></form></div></div></div><div class=col-lg-8><div class="panel panel-default"><div class="panel-heading text-center"><input class=form-control ng-model=search style=height:55px;font-size:26px></div><div class=panel-body><table class="table text-center" style=font-size:15px><thead style=font-weight:bold><td>Nombre</td><td>Precio</td><td>Editar</td></thead><tbody><tr ng-repeat="producto in productos  |  filter:search"><td>{{producto.name}}</td><td>{{producto.precio | currency}}</td><td><button aria-hidden=true ng-click=edit(producto) class="btn btn-success glyphicon glyphicon-pencil"></button> <button aria-hidden=true ng-click=delete(producto) class="btn btn-danger glyphicon glyphicon-remove"></button></td></tr></tbody></table></div></div></div></div></div>'),a.put("app/reportes/reportes%20-%2025-07-2017.html",'<navbar></navbar><div class=container><h3 class=text-center>REPORTES</h3><hr><div class=container-fluid><div class=row><div class=col-lg-4><div class="panel panel-default"><div class=panel-body><label>Desde:</label><p class=input-group><input datepicker-popup="dd-MM-yyyy h:mm a" ng-model=desde.today is-open=desde.status.opened close-text=Cerrar class="form-control"><span class=input-group-btn><button type=button name=desde ng-click=open($event) class="btn btn-default"><i class="glyphicon glyphicon-calendar"></i></button></span></p><label>Hasta:</label><p class=input-group><input datepicker-popup="dd-MM-yyyy h:mm a" ng-model=hasta.today is-open=hasta.status.opened close-text=Cerrar class="form-control"><span class=input-group-btn><button type=button name=hasta ng-click=open($event) class="btn btn-default"><i class="glyphicon glyphicon-calendar"></i></button></span></p><label>Usuario:</label><div class="panel panel-default"><div class="panel-heading text-center"><input ng-change="usuario.hide = false" ng-model=usuario.text class=form-control style="height:55px;font-size:26px"></div><div class=panel-body><div class=container-fluid><div class=row ng-show="usuario.text != undefined"><div ng-show=!usuario.hide style="margin-bottom:10px;padding-top:10px;padding-bottom:10px;font-size:24px;white-space: normal" ng-repeat="u in usuarios | filter:usuario.text" ng-click=selectUser(u) class="col-lg-12 col-xs-12 btn btn-default">{{u.name}}</div></div></div></div></div><label>Producto:</label><div class="panel panel-default"><div class="panel-heading text-center"><input ng-change="producto.hide = false" ng-model=producto.text class=form-control style="height:55px;font-size:26px"></div><div class=panel-body><div class=container-fluid><div class=row ng-show="producto.text != undefined"><div ng-show=!producto.hide style="margin-bottom:10px;padding-top:10px;padding-bottom:10px;font-size:24px;white-space: normal" ng-repeat="p in productos | filter:producto.text" ng-click=selectProduct(p) class="col-lg-12 col-xs-12 btn btn-default">{{p.name}}</div></div></div></div></div><div class=text-right><button class="btn btn-warning" ng-click=getPedidos(desde.today,hasta.today)>Generar Reporte</button></div></div></div></div><div class=col-lg-8><div ng-if=loading class=text-center style=padding-top:120px><img src=assets/images/loading_spinner.69f5ee8d.gif width=50></div><div class=well ng-if="loading == false"><h3>Resultados:</h3><hr><div class=text-center><div class=results ng-if="results.totalOrdenes != 0"><div class=results_header><span class="glyphicon glyphicon-list-alt"></span></div>{{results.totalOrdenes}}</div><div class=results ng-if="results.totalCocina != 0"><div class=results_header><span class="glyphicon glyphicon-cutlery"></span></div>{{results.totalCocina | currency}}</div><div class=results ng-if="results.totalBar != 0"><div class=results_header><span class="glyphicon glyphicon-glass"></span></div>{{results.totalBar | currency}}</div><div ng-if="producto.text == \'Todos\'" style=display:inline-block><div class=results ng-if="results.total != 0"><div class=results_header><span class="glyphicon glyphicon-usd"></span></div><span class=total>{{results.total | currency}}</span></div></div></div></div><div class=table-responsive ng-if="loading == false" style=overflow-y:scroll;height:300px><div class=well ng-if=results.total><table class="table .table-striped"><thead><td><b>Orden ID</b></td><td><b>Detalles</b></td><td><b>Total</b></td><td><b>Ver</b></td></thead><tbody><tr ng-repeat="orden in ordenes track by $index | limitTo:100 "><td>{{orden.orden_id}}</td><td>{{orden.fecha | date: \'dd-MM-yyyy\'}}</td><td>{{orden.total | currency : "$" : 0 }}</td><td><button ng-click=ver(orden) class="btn btn-primary"><span class="glyphicon glyphicon-search"></span></button><!-- <button ng-click="delete(orden)" class="btn btn-danger"><span class="glyphicon glyphicon-minus"></span></button> --></td></tr></tbody></table></div></div><!--                 <div class="well" ng-if="results.total">\n                    <h3>Resultados:</h3>\n                    <hr>\n                    <h4 style="color:blue;">{{producto.text}}</h4>\n                    <div>Cantidad de Ventas: {{results.totalOrdenesConProducto}}</div>\n                    <div>Total en Ventas: {{results.totalSingleProduct | currency}}</div>\n                    <div></div>\n                </div> --></div></div></div></div><footer></footer><script type=text/ng-template id=verOrden.html><div class="modal-header">\n        <h3 class="modal-title">Detalles de orden # {{orden.orden_id}}</h3>\n    </div>\n    <div class="modal-body">\n      <div><b>Orden ingresada por:</b> {{orden.usuario.name}}</div>\n      <div><b>Fecha:</b> {{ orden.fecha | date : \'d-M-yyyy - h:mm:ss a\' }}</div>\n      <div><b>Tipo de orden:</b> {{orden.tipo}}</div>\n      <div><b>Mesa:</b> {{orden.mesa}}</div>\n      <hr>\n      <div class="table-responsive">\n        <table class="table">\n          <thead>\n            <th class="text-left">Pagado</th>\n            <th>Cantidad</th>\n            <th>Producto</th>\n            <th>Precio</th>\n            <th class="text-center">Servido</td>\n          </thead>\n          <tr ng-repeat="producto in orden.productos">\n            <td class="text-left"><span ng-if="producto.pagado == false">{{showPagados(producto)}}</span><span ng-if="producto.pagado == true"  class="glyphicon glyphicon-ok"></span></td>\n            <td>{{producto.cantidad}}</td>\n            <td>{{producto.name}}</td>\n            <td>{{producto.precio * producto.cantidad | currency }}</td>\n            <td ng-if="producto.servido == true" class="text-center"><span class="glyphicon glyphicon-ok"></span></td>\n          </tr>\n        </table>\n      </div>\n      <hr>\n      <div class="precioModal text-center"><b>Total:</b> {{calculateTotal()  | currency}}<hr><b>Por pagar:</b> {{calculatePendiente()  | currency}}</div>\n    </div>\n    <div class="modal-footer">\n        <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>\n    </div></script><script type=text/ng-template id=deleteOrden.html><div class="modal-header">\n        <h3 class="modal-title">Borrar Orden: # {{orden.orden_id}}</h3>\n    </div>    \n    <div class="modal-body">\n      <p><b>Esta seguro que desea borrar la orden #: {{orden.orden_id}}?</b></p>\n      <h4>Observación:</h4>\n      <textarea class="form-control" ng-model="observacion"></textarea>\n    </div>\n    <div class="modal-footer">\n        <div class="text-center">\n        <button class="btn-lg btn-danger" type="button" ng-if="observacion != \'\'" ng-click="borrar()">Borrar</button>\n        </div>\n    </div></script>'),
a.put("app/reportes/reportes%20-%20Copy.html",'<navbar></navbar><div class=container><h3 class=text-center>REPORTES</h3><hr><div class=container-fluid><div class=row><div class="col-lg-12 col-xs-12"><label>Usuario:</label><select ng-model=user class=form-control ng-change=search()><option value=todos>Todos</option><option ng-repeat="usuario in usuarios" value={{usuario.name}}>{{usuario.name}}</option></select></div></div><div class=row><div class="col-lg-12 col-xs-12"><br><!-- 	    <label>Producto: </label>\n	      <select ng-model="productoField" class="form-control" ng-change="search()">\n	        <option value="todos">Todos</option>\n	        <option ng-repeat="producto in productos" value="{{producto.name}}">{{producto.name}}</option>\n	      </select> --><div class="panel panel-default"><div class="panel-heading text-center"><input ng-model=productoField ng-change=search() class=form-control style="height:55px;font-size:26px"></div><div class=panel-body><div class=container-fluid><div class=row><div style="margin-bottom:10px;padding-top:10px;padding-bottom:10px;font-size:24px;white-space: normal" ng-repeat="producto in productos | filter:productoField" ng-click=change(producto.name) class="col-lg-12 col-xs-12 btn btn-default">{{producto.name}}</div></div></div></div></div></br></div></div><div class=row><div class="col-lg-6 col-xs-6"><br><label>Desde:</label><p class=input-group><input datepicker-popup={{format}} ng-change=search() ng-model=desde is-open=desde.status.opened min-date=minDate max-date="\'2020-06-22\'" datepicker-options=dateOptions date-disabled="disabled(date, mode)" ng-required=true close-text=Cerrar class="form-control"><span class=input-group-btn><button type=button name=desde ng-click=open($event) class="btn btn-default"><i class="glyphicon glyphicon-calendar"></i></button></span></p><input ng-model=desdeTime class="form-control"></div><div class="col-lg-6 col-xs-6"><br><label>Hasta:</label><p class=input-group><input datepicker-popup={{format}} ng-change=search() ng-model=hasta is-open=hasta.status.opened max-date="\'2020-06-22\'" datepicker-options=dateOptions date-disabled="disabled(date, mode)" ng-required=true close-text=Cerrar class="form-control"><span class=input-group-btn><button type=button name=hasta ng-click=open($event) class="btn btn-default"><i class="glyphicon glyphicon-calendar"></i></button></span></p><input ng-model=hastaTime class="form-control"></div></div><div class=row><div class="col-lg-12 col-xs-12 text-right"><br><button ng-click=search() class="btn-lg btn-danger" disabled ng-if="cargando == true">CARGANDO ORDENES...</button> <button ng-click=search() class="btn-lg btn-success" ng-if="cargando == false">GENERAR REPORTE</button></div></div></div><div class=panel-body><div class=container-fluid style=font-size:18px><div class=row><div ng-if=cocinaTotal class="col-xs-12 col-lg-12 text-left">Ventas en productos de Cocina: <b>{{ cocinaTotal | currency }}</b></div></div><div class=row><div ng-if="barTotal &gt; 0" class="col-xs-12 col-lg-12 text-left">Ventas en productos de Bar: <b>{{ barTotal | currency }}</b></div></div><hr><div class=row><div ng-if="barTotal &gt; 0" class="col-xs-12 col-lg-12 text-left">Venta Total del Local: <b>{{ barTotal + cocinaTotal | currency }}</b></div><br><br></div><div class=row><div ng-if="cantidadTotalProducto &gt; 0">{{productoField}}: {{cantidadTotalProducto}} vendido(s)<br>Total producto vendido: {{productoTotal | currency }}<br><br></div></div><div class=row><div ng-repeat="orden in ordenes |  filter:busqueda" class="col-lg-6 col-lg-12"><div class="panel panel-default"><div class=panel-heading><div class=container-fluid><div class=row style=font-size:26px><div class="col-lg-4 col-xs-4 text-left"># {{orden.orden_id}}</div><div class="col-lg-4 col-xs-4 text-center">{{orden.mesa}}</div><div class="col-lg-4 col-xs-4 text-right">{{productCount(orden)}}</div></div></div></div><div class=panel-body><div class="container-fluid text-center"><button aria-hidden=true ng-click=ver(orden) style="font-size: 30px" class="btn-lg btn-primary glyphicon glyphicon-search"></button></div></div></div></div></div></div></div></div><footer></footer><script type=text/ng-template id=verOrden.html><div class="modal-header">\n        <h3 class="modal-title">Detalles de orden # {{orden.orden_id}}</h3>\n    </div>\n    <div class="modal-body">\n      <div><b>Orden ingresada por:</b> {{orden.usuario.name}}</div>\n      <div><b>Fecha:</b> {{ orden.fecha | date : \'d-M-yyyy - h:mm:ss a\' }}</div>\n      <div><b>Tipo de orden:</b> {{orden.tipo}}</div>\n      <div><b>Mesa:</b> {{orden.mesa}}</div>\n      <hr>\n      <div class="table-responsive">\n        <table class="table">\n          <thead>\n            <th>Cantidad</th>\n            <th>Producto</th>\n            <th>Precio</th>\n            <th class="text-center">Servido</td>\n          </thead>\n          <tr ng-repeat="producto in orden.productos">\n  \n            <td>{{producto.cantidad}}</td>\n            <td>{{producto.name}}</td>\n            <td>{{producto.precio * producto.cantidad | currency }}</td>\n            <td ng-if="producto.servido == true" class="text-center"><span class="glyphicon glyphicon-ok"></span></td>\n          </tr>\n        </table>\n      </div>\n      <hr>\n      <div class="text-center"><b>Total:</b> {{calculateTotal()  | currency}}</div>\n    </div>\n    <div class="modal-footer">\n        <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>\n    </div></script>'),a.put("app/reportes/reportes.html",'<navbar></navbar><div class=container><h3 class=text-center>REPORTES</h3><hr><div class=container-fluid><div class=row><div class=col-lg-4><div class="panel panel-default"><div class=panel-body><label>Buscar por # de Orden:</label><input class=form-control name=orden_id ng-model=orden_id><br><button class="btn btn-warning center-block" ng-click=getOrden(orden_id)>Buscar Orden</button><hr><label>Desde:</label><p class=input-group><input datepicker-popup="dd-MM-yyyy h:mm a" ng-model=desde.today is-open=desde.status.opened close-text=Cerrar class="form-control"><span class=input-group-btn><button type=button name=desde ng-click=open($event) class="btn btn-default"><i class="glyphicon glyphicon-calendar"></i></button></span></p><label>Hasta:</label><p class=input-group><input datepicker-popup="dd-MM-yyyy h:mm a" ng-model=hasta.today is-open=hasta.status.opened close-text=Cerrar class="form-control"><span class=input-group-btn><button type=button name=hasta ng-click=open($event) class="btn btn-default"><i class="glyphicon glyphicon-calendar"></i></button></span></p><label>Usuario:</label><div class="panel panel-default"><div class="panel-heading text-center"><input ng-change="usuario.hide = false" ng-model=usuario.text class=form-control style="height:55px;font-size:26px"></div><div class=panel-body><div class=container-fluid><div class=row ng-show="usuario.text != undefined"><div ng-show=!usuario.hide style="margin-bottom:10px;padding-top:10px;padding-bottom:10px;font-size:24px;white-space: normal" ng-repeat="u in usuarios | filter:usuario.text" ng-click=selectUser(u) class="col-lg-12 col-xs-12 btn btn-default">{{u.name}}</div></div></div></div></div><!--             <label>Producto: </label>\n            <div class="panel panel-default">\n              <div class="panel-heading text-center">\n                <input type="text" ng-change="producto.hide = false" ng-model="producto.text" class="form-control" style="height:55px;font-size:26px;" />\n              </div>\n              <div class="panel-body">\n                <div class="container-fluid">\n                  <div class="row" ng-show="producto.text != undefined">\n                    <div ng-show="!producto.hide" style="margin-bottom:10px;padding-top:10px;padding-bottom:10px;font-size:24px;white-space: normal;" ng-repeat="p in productos | filter:producto.text" ng-click="selectProduct(p)" class="col-lg-12 col-xs-12 btn btn-default">{{p.name}}</div>\n                  </div>\n                </div>\n              </div>\n            </div> --><div class=text-right><button class="btn btn-warning" ng-click=getPedidos(desde.today,hasta.today)>Generar Reporte</button></div></div></div></div><div class=col-lg-8><div ng-if=loading class=text-center style=padding-top:120px><img src=assets/images/loading_spinner.69f5ee8d.gif width=50></div><tabset justified=true><tab heading=VENTAS active=isActiveVentas><hr><table class=table><thead><tr><th>Tipo de Producto</th><th>Monto Vendido ($)</th></tr></thead><tbody><tr ng-repeat="g in general"><td>{{g._id}}</td><td>{{g.value | currency }}</td></tr><tr><td align=right><h4>TOTAL:</h4></td><td><h4>{{ totalVentas | currency }}</h4></td></tr></tbody></table></tab><tab heading=Tickets active=isActiveTickets><hr><div style=overflow-y:scroll;height:300px><div class=well><table class="table .table-striped"><thead><td><b>Orden ID</b></td><td><b>Detalles</b></td><td><b>Total</b></td><td><b>Ver</b></td></thead><tbody><tr ng-repeat="orden in ordenes track by $index | limitTo:100 "><td>{{orden.orden_id}}</td><td>{{orden.fecha | date: \'dd-MM-yyyy\'}}</td><td>{{orden.total | currency : "$" : 0 }}</td><td><button ng-click=ver(orden) class="btn btn-primary"><span class="glyphicon glyphicon-search"></span></button> <button ng-if="orden.observaciones.length != 0" class="btn btn-warning"><span class="glyphicon glyphicon-info-sign"></span></button> <button ng-if=orden.observacion class="btn btn-danger"><span class="glyphicon glyphicon-trash"></span></button><!-- <button ng-click="delete(orden)" class="btn btn-danger"><span class="glyphicon glyphicon-minus"></span></button> --></td></tr></tbody></table></div></div></tab><tab heading=Ranking><hr><div class=table-responsive style=overflow-y:scroll;height:300px><table class=table><thead><th>#</th><th><input class=form-control ng-model=busqueda.text placeholder="Buscar producto aqui..."></th><th>Cantidad</th><!-- <th>Monto</th> --></thead><tbody><tr ng-repeat="producto in productosVendidos | orderBy:\'-value\' | filter:busqueda.text"><td>{{ $index + 1 }}</td><td>{{producto._id}}</td><td><b>{{producto.value }}</b></td><!-- <td><b>{{producto.value.precio * producto.value.cantidad | currency : "$" : 0}}</b></td> --></tr></tbody></table></div></tab></tabset></div></div></div></div><footer></footer><script type=text/ng-template id=verOrden.html><div class="modal-header">\n    <h3 class="modal-title">Detalles de orden # {{orden.orden_id}}</h3>\n  </div>\n  <div class="modal-body">\n    <div ng-if="orden.status == \'Borrado\'"><b>Estado:</b> {{orden.status}}</div>\n    <div ng-if="orden.status == \'Borrado\'"><b>Observacion al Borrar:</b> {{orden.observacion}}\n    </div>\n    <div><b>Orden ingresada por:</b> {{orden.usuario.name}}</div>\n    <div><b>Fecha:</b> {{ orden.fecha | date : \'d-M-yyyy - h:mm:ss a\' }}</div>\n    <div><b>Tipo de orden:</b> {{orden.tipo}}</div>\n    <div><b>Mesa:</b> {{orden.mesa}}</div>\n    <hr>\n    <div class="table-responsive">\n      <table class="table">\n        <thead>\n          <th class="text-left">Pagado</th>\n          <th>Cantidad</th>\n          <th>Producto</th>\n          <th>Precio</th>\n          <th class="text-center">Servido</td>\n        </thead>\n        <tr ng-repeat="producto in orden.productos">\n          <td class="text-left"><span ng-if="producto.pagado == false">{{showPagados(producto)}}</span><span ng-if="producto.pagado == true" class="glyphicon glyphicon-ok"></span></td>\n          <td>{{producto.cantidad}}</td>\n          <td>{{producto.name}}</td>\n          <td>{{producto.precio * producto.cantidad | currency }}</td>\n          <td ng-if="producto.servido == true" class="text-center"><span class="glyphicon glyphicon-ok"></span></td>\n        </tr>\n      </table>\n    </div>\n    <hr>\n    <div class="precioModal text-center"><b>Total:</b> {{calculateTotal() | currency}}\n      <hr><b>Por pagar:</b> {{calculatePendiente() | currency}}</div>\n    <div ng-if="orden.observaciones.length != 0">\n      <hr>\n      <div><b>Historial de Modificaciones:</b></div>\n      <div class="table-responsive">\n        <table class="table">\n          <thead>\n            <th>Fecha</th>\n            <th>Observacion</th>\n            <th>Producto</th>\n          </thead>\n          <tr ng-repeat="o in orden.observaciones">\n            <td class="text-left">{{o.fecha | date : \'d-M-yyyy - h:mm:ss a\'}}</td>\n            <td class="text-left">{{o.observacion}}</td>\n            <td class="text-left">{{o.producto.name}}</td>\n          </tr>\n        </table>\n      </div>\n    </div>\n  </div>\n  <div class="modal-footer">\n    <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>\n  </div></script><script type=text/ng-template id=deleteOrden.html><div class="modal-header">\n    <h3 class="modal-title">Borrar Orden: # {{orden.orden_id}}</h3>\n  </div>\n  <div class="modal-body">\n    <p><b>Esta seguro que desea borrar la orden #: {{orden.orden_id}}?</b></p>\n    <h4>Observación:</h4>\n    <textarea class="form-control" ng-model="observacion"></textarea>\n  </div>\n  <div class="modal-footer">\n    <div class="text-center">\n      <button class="btn-lg btn-danger" type="button" ng-if="observacion != \'\'" ng-click="borrar()">Borrar</button>\n    </div>\n  </div></script>'),a.put("app/ticket/ticket.html",'<div class=paper><!-- 	  <h3 class="text-center"><b>Kanguru Beach Bar</b></h3> --><img class="logo center-block" src=../assets/images/logo.47556d8e.png><br><div><b># de Orden:</b> {{orden.orden_id}}</div><div><b>Fecha:</b> {{ orden.fecha | date : \'d-M-yyyy - h:mm:ss a\' }}</div><div><b>Tipo de orden:</b> {{orden.tipo}}</div><div><b>Mesa:</b> {{orden.mesa}}</div><hr><table class=table><thead><th>Cantidad</th><th>Producto</th><th>Precio</th></thead><tr ng-repeat="producto in orden.productos"><td>{{producto.cantidad}}</td><td>{{producto.name}}</td><td>{{producto.precio * producto.cantidad | currency: $: 0}}</td></tr></table><hr><div class=text-center><b>Por pagar:</b> {{calculatePendiente() | currency: $: 0}}</div><div class=text-center><b>Propina:</b> {{ totalPropina | currency: $: 0 }}</div><h3><div class=text-center><b>TOTAL:</b> {{ totalWithPropina | currency: $: 0 }}</div></h3><hr></div>'),a.put("app/usuarios/usuarios.html",'<navbar></navbar><div class=container><h3 class=text-center>USUARIOS</h3><hr><div class=row><div class="col-lg-4 text-left"><div class="panel panel-default"><div class=panel-body><form id=usuario-form><div class=row><div class=col-lg-12><div id=error-message></div><label style=margin-top:10px>Nombre:</label><input name=nombre class=form-control ng-model="name"><label style=margin-top:10px>R.U.T:</label><input name=rut class=form-control ng-model="rut"><label style=margin-top:10px>Contraseña:</label><input name=password class=form-control ng-model="password"><label style=margin-top:10px>Tipo de Usuario:</label><select ng-model=tipo required class=form-control><option value=administrador>Administrador</option><option value=caja>Caja</option><option value=cocina>Cocina</option><option value=mesero>Mesero</option><option value=bar>Bar</option></select></div></div><div class=row><div class="col-lg-12 text-right"><button style=margin-top:20px ng-click=add() ng-if="editing != true" class="btn btn-primary">INGRESAR</button> <button style=margin-top:20px ng-click=cancelar() ng-if="editing == true" class="btn btn-danger">CANCELAR</button> <button style=margin-top:20px ng-click=update() ng-if="editing == true" class="btn btn-success">ACTUALIZAR</button></div></div></form></div></div></div><div class="col-lg-8 text-center"><div class="panel panel-default"><div class="panel-heading text-center"><input class=form-control ng-model=search style=height:55px;font-size:26px></div><div class=panel-body><div class=table-responsive><table class="table text-center" style=font-size:15px><thead style=font-weight:bold><td>Nombre</td><td>R.U.T</td><td>Rol</td><td>Editar</td></thead><tbody><tr ng-repeat="usuario in usuarios  |  filter:search" ng-if="usuario.name != \'Admin\'"><td>{{usuario.name}}</td><td>{{usuario.rut}}</td><td>{{usuario.role}}</td><td><button aria-hidden=true ng-click=edit(usuario) class="btn btn-success glyphicon glyphicon-pencil"></button> <button aria-hidden=true ng-click=delete(usuario) class="btn btn-danger glyphicon glyphicon-remove"></button></td></tr></tbody></table></div></div></div></div></div></div><footer></footer>'),a.put("components/footer/footer.html","<div class=container><p>Sistema de Ventas v3.0 | <a href=#>Jesus Villarroel</a> | <a href=#>jvr42@hotmail.com</a></p></div>"),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<div class="navbar navbar-default navbar-static-top" ng-controller=NavbarCtrl><div class=container><div class=navbar-header><button class=navbar-toggle type=button ng-click="isCollapsed = !isCollapsed"><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a class=navbar-brand style="font-size: 14px;color: black"><b>Kanguru Beach Bar</b></a></div><div collapse=isCollapsed class="navbar-collapse collapse" id=navbar-main><ul class="nav navbar-nav"><li ng-repeat="item in menu" ui-sref-active=active><a ng-show=isLoggedIn() ng-if="check(item.auth, getRole())" ui-sref={{item.state}}>{{item.title}}</a></li></ul><ul class="nav navbar-nav navbar-right"><li ng-hide=isLoggedIn() ui-sref-active=active><a ui-sref=login>Iniciar Sesion</a></li><li ng-show=isLoggedIn()><p class=navbar-text>{{ getCurrentUser().name }}</p></li><li ng-show=isLoggedIn()><a ui-sref=logout>Cerrar Sesion</a></li></ul></div></div></div>')}]);