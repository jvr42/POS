"use strict";angular.module("posApp",["ngCookies","ngResource","ngSanitize","btford.socket-io","ui.router","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(a,b,c,d){b.otherwise("/"),c.html5Mode(!0),d.interceptors.push("authInterceptor")}]).factory("authInterceptor",["$rootScope","$q","$cookies","$injector",function(a,b,c,d){var e;return{request:function(a){return a.headers=a.headers||{},c.get("token")&&(a.headers.Authorization="Bearer "+c.get("token")),a},responseError:function(a){return 401===a.status?((e||(e=d.get("$state"))).go("login"),c.remove("token"),b.reject(a)):b.reject(a)}}}]).run(["$rootScope","$state","Auth",function(a,b,c){a.$on("$stateChangeStart",function(a,d){d.authenticate&&c.isLoggedIn(function(c){c||(a.preventDefault(),b.go("login"))})})}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("login",{url:"/",templateUrl:"app/account/login/login.html",controller:"LoginCtrl"}).state("logout",{url:"/logout?referrer",referrer:"login",template:"",controller:["$state","Auth",function(a,b){var c="login";b.logout(),a.go(c)}]}).state("signup",{url:"/signup",templateUrl:"app/account/signup/signup.html",controller:"SignupCtrl"}).state("settings",{url:"/settings",templateUrl:"app/account/settings/settings.html",controller:"SettingsCtrl",authenticate:!0})}]).run(["$rootScope",function(a){a.$on("$stateChangeStart",function(a,b,c,d){"logout"===b.name&&d&&d.name&&!d.authenticate&&(b.referrer=d.name)})}]),angular.module("posApp").controller("LoginCtrl",["$scope","Auth","$state",function(a,b,c){a.user={},a.errors={},a.login=function(d){a.submitted=!0,d.$valid&&b.login({rut:a.user.rut,password:a.user.password}).then(function(a){"cocina"==a.role?c.go("cocina"):"bar"==a.role?c.go("bar"):c.go("main")})["catch"](function(b){a.errors.other=b.message})}}]),angular.module("posApp").controller("ArchivoCtrl",["$scope","$http","Auth","socket","$modal","$state",function(a,b,c,d,e,f){c.isLoggedIn(function(a){a||f.go("login")}),a.cargando=!0,b.get("/api/ordenes/all").then(function(b){a.ordenes=b.data,a.cargando=!1}),a.abierta=function(a){return"cerrada"==a.status?!1:!0},a.productCount=function(a){var b=0;return $.each(a.productos,function(a,c){1==c.servido&&b++}),b+" / "+a.productos.length},a.edit=function(a){f.go("editar",{id:a})},a.ver=function(a){e.open({templateUrl:"verOrden.html",controller:"verCtrl",resolve:{orden:function(){return a}}})}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("archivo",{url:"/archivo",templateUrl:"app/archivo/archivo.html",controller:"ArchivoCtrl"})}]),angular.module("posApp").controller("BarCtrl",["$scope","$http","socket","Orden","Auth","$state",function(a,b,c,d,e,f){e.isLoggedIn(function(a){a||f.go("login")}),b.get("/api/ordenes/").then(function(b){a.ordenes=b.data,c.syncUpdates("ordenes",a.ordenes)}),a.listo=function(a,b){_.find(a.productos,{_id:b._id}).servido=!0,d.update({id:a._id},a)},a.revisa=function(a){return _.find(a.productos,{tipo:"bar"})&&_.find(a.productos,{servido:!1,tipo:"bar"})?!0:!1}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("bar",{url:"/bar",templateUrl:"app/bar/bar.html",controller:"BarCtrl"})}]),angular.module("posApp").controller("CajaCtrl",["$scope","$http","socket","Orden","$modal","$state","Modal","Auth",function(a,b,c,d,e,f,g,h){h.isLoggedIn(function(a){a||f.go("login")}),a.user="",a.orden_id="",b.get("/api/users").success(function(b){a.usuarios=b}),b.get("/api/ordenes/").then(function(b){a.ordenes=b.data,c.syncUpdates("ordenes",a.ordenes)}),a["delete"]=g.confirm["delete"](function(a){d.remove({id:a._id})}),a.abierta=function(a){return"cerrada"==a.status?!1:!0},a.productCount=function(a){var b=0;return $.each(a.productos,function(a,c){1==c.servido&&b++}),b+" / "+a.productos.length},a.edit=function(a){f.go("editar",{id:a})},a.ver=function(a){e.open({templateUrl:"verOrden.html",controller:"verCtrl",resolve:{orden:function(){return a}}})},a.pay=function(a){e.open({templateUrl:"payOrden.html",controller:"payCtrl",resolve:{orden:function(){return a}}})},a.divide=function(a){e.open({templateUrl:"divideOrden.html",controller:"divideCtrl",resolve:{orden:function(){return a}}})}}]),angular.module("posApp").controller("verCtrl",["$scope","$modalInstance","orden",function(a,b,c){a.orden=c,a.calculateTotal=function(){for(var b=0,c=0;c<a.orden.productos.length;c++){var d=a.orden.productos[c].precio*a.orden.productos[c].cantidad;b+=d}return b},a.calculatePendiente=function(){for(var b=0,c=0,d=0;d<a.orden.productos.length;d++){var e=a.orden.productos[d].pagados*a.orden.productos[d].precio,f=a.orden.productos[d].precio*a.orden.productos[d].cantidad;c+=e,b+=f}return b-c},a.showPagados=function(a){return a.pagados+" / "+a.cantidad},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("posApp").controller("payCtrl",["$rootScope","$scope","$modalInstance","orden","Orden","$state",function(a,b,c,d,e,f){b.orden=d,b.tipoPago="efectivo",b.propinaclass="success",b.totalPropina=0,b.calculateTotal=function(){for(var a=0,c=0;c<b.orden.productos.length;c++){var d=b.orden.productos[c].precio*b.orden.productos[c].cantidad;a+=d}return a},b.calculatePendiente=function(){for(var a=0,c=0,d=0;d<b.orden.productos.length;d++){var e=b.orden.productos[d].pagados*b.orden.productos[d].precio,f=b.orden.productos[d].precio*b.orden.productos[d].cantidad;c+=e,a+=f}return a-c},b.aplicarPropina=function(){b.totalPropina=.1*b.calculatePendiente(),b.totalWithPropina=b.totalPropina+b.calculatePendiente(),b.propinaToggle()},b.propinaToggle=function(){1==b.propina?(b.propinaclass="success",b.propina=!1,b.totalPropina=0):(b.propinaclass="danger",b.propina=!0)},b.showPagados=function(a){return a.pagados+" / "+a.cantidad},b.pagar=function(){b.orden.total=b.calculateTotal(),b.orden.propina=b.propina,b.orden.servida=!0,b.orden.descuento=b.descuento,b.orden.fechaCierre=(new Date).getTime(),b.orden.numeroBoleta=b.numeroBoleta,b.orden.tipoPago=b.tipoPago;for(var a=0;a<b.orden.productos.length;a++)b.orden.productos[a].pagado="true",b.orden.productos[a].servido="true";b.orden.status="cerrada",e.update({id:b.orden._id},b.orden),c.dismiss("cerrar")},b.cerrar=function(){c.dismiss("cerrar")}}]),angular.module("posApp").controller("divideCtrl",["$scope","$modalInstance","orden","Orden",function(a,b,c,d){a.o=c,a.subticket=[],a.pagar=function(b){var c=_.clone(b);c.cantidad=1,_.find(a.subticket,{_id:c._id})?(_.find(a.subticket,{_id:c._id}).cantidad++,b.pagados++,b.pagados==b.cantidad?b.pagado=!0:b.pagado=!1):(a.subticket.push(c),b.pagados++,b.pagados==b.cantidad?b.pagado=!0:b.pagado=!1),d.update({id:a.o._id},a.o)},a.revertir=function(b){var c=_.clone(b);_.find(a.subticket,{_id:c._id})&&(_.find(a.subticket,{_id:c._id}).cantidad--,b.pagados--,b.pagados==b.cantidad?b.pagado=!0:b.pagado=!1,0==_.find(a.subticket,{_id:c._id}).cantidad&&_.remove(a.subticket,{_id:c._id})),d.update({id:a.o._id},a.o)},a.calculateTotal=function(){for(var b=0,c=0;c<a.subticket.length;c++){var d=a.subticket[c].precio*a.subticket[c].cantidad;b+=d}return b},a.checkSubticket=function(b){return _.find(a.subticket,{_id:b._id})},a.cerrar=function(){b.dismiss("cerrar")}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("caja",{url:"/caja",templateUrl:"app/caja/caja.html",controller:"CajaCtrl"})}]),angular.module("posApp").controller("CocinaCtrl",["$scope","$http","socket","Orden","Auth","$state",function(a,b,c,d,e,f){e.isLoggedIn(function(a){a||f.go("login")}),b.get("/api/ordenes/").then(function(b){a.ordenes=b.data,c.syncUpdates("ordenes",a.ordenes)}),a.listo=function(a,b){_.find(a.productos,{_id:b._id}).servido=!0,d.update({id:a._id},a)},a.revisa=function(a){return _.find(a.productos,{tipo:"cocina"})&&_.find(a.productos,{servido:!1,tipo:"cocina"})?!0:!1}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("cocina",{url:"/cocina",templateUrl:"app/cocina/cocina.html",controller:"CocinaCtrl"})}]),angular.module("posApp").controller("ConfigCtrl",["$scope","Counter","$interval","Auth","$state",function(a,b,c,d,e){d.isLoggedIn(function(a){a||e.go("login")}),b.query(function(b){a.counters=b,a.countId=b[0]._id,a.orden_id=b[0].orden_id}),a.updateCounter=function(c){var d={orden_id:a.orden_id};return b.update({id:a.countId},d),c("Reseteado!")},a.showNotification=function(b){a.notification=b,c(function(){a.notification=""},2e3)}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("config",{url:"/config",templateUrl:"app/config/config.html",controller:"ConfigCtrl"})}]),angular.module("posApp").controller("EditarCtrl",["$scope","$http","$state","socket","Producto","Auth","$stateParams","Orden",function(a,b,c,d,e,f,g,h){f.isLoggedIn(function(a){a||c.go("login")}),a.ticket=[],a.orden_id=g.id,a.userRole=f.getCurrentUser().role,a.data={tipo:"servir",mesa:"t 1",orden_id:""},b.get("/api/ordenes/"+a.orden_id).then(function(b){a.orden=b.data,a.ticket=a.orden.productos,a.data.orden_id=a.orden.orden_id,a.data.tipo=a.orden.tipo,a.data.mesa=a.orden.mesa}),b.get("/api/productos").then(function(b){a.productos=b.data,d.syncUpdates("producto",a.productos)}),a.updateTicket=function(){if(0!=a.ticket.length&&""!=a.tipo){var b={},d=f.getCurrentUser();b.fechaEditado=(new Date).getTime(),b.status="abierta",b.usuario=d,b.tipo=a.data.tipo,b.mesa=a.data.mesa,b.productos=a.ticket,b.total=a.calculateTotal(),b.servida=!1,h.update({id:a.orden._id},b,function(){a.ticket=[],a.data.tipo="servir",a.data.mesa="1",c.go("ordenes")})}else alert("Ingrese productos a la orden antes de continuar...")},a.addToTicket=function(b){_.find(a.ticket,{_id:b._id})?_.find(a.ticket,{_id:b._id}).cantidad++:(b._id=(new Date).getTime(),a.ticket.push(b))},a.deleteItem=function(b){_.find(a.ticket,{_id:b._id})?(_.find(a.ticket,{_id:b._id}).cantidad--,0==_.find(a.ticket,{_id:b._id}).cantidad&&(_.remove(a.ticket,{_id:b._id}),b.cantidad=1)):_.remove(a.ticket,{_id:b._id})},a.calculateTotal=function(){for(var b=0,c=0;c<a.ticket.length;c++){var d=a.ticket[c].precio*a.ticket[c].cantidad;b+=d}return b},a.$on("$destroy",function(){d.unsyncUpdates("producto")})}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("editar",{url:"/editar/:id",templateUrl:"app/editar/editar.html",controller:"EditarCtrl"})}]),angular.module("posApp").controller("MainCtrl",["$scope","$http","$state","socket","Producto","Auth","Counter",function(a,b,c,d,e,f,g){f.isLoggedIn(function(a){a||c.go("login")}),a.ticket=[],a.data={tipo:"servir",mesa:"t 1"},b.get("/api/productos").then(function(b){a.productos=b.data,d.syncUpdates("producto",a.productos)}),a.addTickeToQueue=function(){if(0!=a.ticket.length&&""!=a.tipo){var d={},e=f.getCurrentUser();g.query(function(f){a.CounterObjectId=f[0]._id,a.currentOrdenId=f[0].orden_id,a.orden_id=a.currentOrdenId+1;var h={orden_id:a.orden_id};g.update({id:a.CounterObjectId},h),d.orden_id=a.orden_id,d.fechaEditado=(new Date).getTime(),d.status="abierta",d.usuario=e,d.propina="",d.numeroBoleta="",d.fechaCierre="",d.descuento="",d.tipo=a.data.tipo,d.mesa=a.data.mesa,d.productos=a.ticket,d.fecha=(new Date).getTime(),d.fecha_alt=(new Date).toLocaleString(),d.total=a.calculateTotal(),d.servida=!1,b.post("/api/ordenes",d).then(function(){a.ticket=[],a.data.tipo="servir",a.data.mesa="1",c.go("ordenes")})})}else alert("Ingrese todos los datos antes de continuar...")},a.addToTicket=function(b){_.find(a.ticket,{_id:b._id})?_.find(a.ticket,{_id:b._id}).cantidad++:(b._id=(new Date).getTime(),a.ticket.push(b))},a.deleteItem=function(b){_.find(a.ticket,{_id:b._id})?(_.find(a.ticket,{_id:b._id}).cantidad--,0==_.find(a.ticket,{_id:b._id}).cantidad&&(_.remove(a.ticket,{_id:b._id}),b.cantidad=1)):_.remove(a.ticket,{_id:b._id})},a.calculateTotal=function(){for(var b=0,c=0;c<a.ticket.length;c++){var d=a.ticket[c].precio*a.ticket[c].cantidad;b+=d}return b},a.$on("$destroy",function(){d.unsyncUpdates("thing")})}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("main",{url:"/main",templateUrl:"app/main/main.html",controller:"MainCtrl"})}]),angular.module("posApp").controller("OrdenesCtrl",["$scope","$http","Auth","socket","$modal","$state",function(a,b,c,d,e,f){c.isLoggedIn(function(a){a||f.go("login")}),b.get("/api/ordenes/user/"+c.getCurrentUser().name).then(function(b){a.ordenes=b.data,d.syncUpdates("ordenes",a.ordenes,function(b,d,e){if(c.getCurrentUser().name!=d.usuario.name){var f=_.find(a.ordenes,{_id:d._id}),g=a.ordenes.indexOf(f);a.ordenes.splice(g,1)}if("cerrada"==d.status){var f=_.find(a.ordenes,{_id:d._id}),g=a.ordenes.indexOf(f);a.ordenes.splice(g,1)}})}),a.abierta=function(a){return"cerrada"==a.status?!1:!0},a.productCount=function(a){var b=0;return $.each(a.productos,function(a,c){1==c.servido&&b++}),b+" / "+a.productos.length},a.edit=function(a){f.go("editar",{id:a})},a.ver=function(a){e.open({templateUrl:"verOrden.html",controller:"verCtrl",resolve:{orden:function(){return a}}})}}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("ordenes",{url:"/ordenes",templateUrl:"app/ordenes/ordenes.html",controller:"OrdenesCtrl"})}]),angular.module("posApp").controller("ProductosCtrl",["$scope","Producto","socket","Auth","$state",function(a,b,c,d,e){d.isLoggedIn(function(a){a||e.go("login")}),a.tipo="cocina",a.productos=b.query(),c.syncUpdates("producto",a.productos),a["delete"]=function(c){b.remove({id:c._id}),a.productos.splice(this.$index,1)},a.add=function(){if(a.name&&a.precio){var c={name:a.name,precio:a.precio,cantidad:1,tipo:a.tipo};b.save(c,function(){a.name="",a.precio="",a.tipo="cocina"})}else alert("Debes completar el formulario antes de ingresar un Producto")},a.edit=function(b){a.editing=!0,a.id=b._id,a.name=b.name,a.precio=b.precio,a.tipo=b.tipo},a.update=function(){a.producto=b.get({id:a.id},function(){a.producto.name=a.name,a.producto.precio=a.precio,a.producto.tipo=a.tipo,a.producto.$update(function(){a.id="",a.name="",a.precio="",a.tipo="cocina",a.editing=!1})})},a.cancelar=function(){a.id="",a.name="",a.precio="",a.tipo="cocina",a.editing=!1},a.$on("$destroy",function(){c.unsyncUpdates("producto")})}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("productos",{url:"/productos",templateUrl:"app/productos/productos.html",controller:"ProductosCtrl"})}]),angular.module("posApp").controller("ReportesCtrl",["$scope","$http","$filter","Auth","$state","$modal","$timeout",function(a,b,c,d,e,f,g){d.isLoggedIn(function(a){a||e.go("login")}),a.ordenes=[],a.user="todos",a.productoField="todos",a.cargando=!0,b.get("/api/users").success(function(b){a.usuarios=b}),b.get("/api/productos").success(function(b){a.productos=b}),b.get("/api/ordenes/all").then(function(b){a.data=b.data,a.cargando=!1}),a.change=function(b){a.productoField=b,a.search()},a.ver=function(a){f.open({templateUrl:"verOrden.html",controller:"verCtrl",resolve:{orden:function(){return a}}})},a.today=function(){a.desde=new Date,a.hasta=new Date},a.time=function(){a.desdeTime="00:00",a.hastaTime="23:59"},a.today(),a.time(),a.desde.status={opened:!1},a.hasta.status={opened:!1},a.open=function(b){"desde"==b.currentTarget.name&&(a.desde.status={opened:!0}),"hasta"==b.currentTarget.name&&(a.hasta.status={opened:!0})},a.search=function(){var b=c("date")(a.desde,"MM/dd/yyyy"),d=c("date")(a.hasta,"MM/dd/yyyy"),e=a.desdeTime,f=a.hastaTime,g=b+" "+e,h=d+" "+f;g=new Date(g),h=new Date(h);var i=0,j=0,k=0,l=0;a.ordenes=[],$.each(a.data,function(b,c){c.fecha>=g.getTime()&&c.fecha<=h.getTime()&&("cerrado"==c.status||"cerrada"==c.status)&&("todos"==a.user?$.each(c.productos,function(b,c){if("todos"==a.productoField){if("cocina"==c.tipo){var d=c.precio*c.cantidad;i+=d}if("bar"==c.tipo){var e=c.precio*c.cantidad;j+=e}}else if(c.name==a.productoField){var f=c.precio*c.cantidad;k+=c.cantidad,l+=f}}):c.usuario.name==a.user&&$.each(c.productos,function(b,c){if("todos"==a.productoField){if("cocina"==c.tipo){var d=c.precio*c.cantidad;i+=d}if("bar"==c.tipo){var e=c.precio*c.cantidad;j+=e}}else if(c.name==a.productoField){var f=c.precio*c.cantidad;k+=c.cantidad,l+=f}}))}),a.cantidadTotalProducto=k,a.productoTotal=l,a.cocinaTotal=i,a.barTotal=j},a.dateOptions={formatYear:"yy",startingDay:1},a.format="dd/MM/yyyy"}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("reportes",{url:"/reportes",templateUrl:"app/reportes/reportes.html",controller:"ReportesCtrl"})}]),angular.module("posApp").controller("UsuariosCtrl",["$scope","User","Auth","socket","$state",function(a,b,c,d,e){c.isLoggedIn(function(a){a||e.go("login")}),a.editing=!1,a.tipo="administrador",a.usuarios=b.query(),d.syncUpdates("user",a.usuarios),a.add=function(){if(a.name&&a.password){var b={name:a.name,rut:a.rut,password:a.password,role:a.tipo};c.createUser(b,function(){a.name="",a.rut="",a.tipo="",a.password=""})}else alert("Completa el formulario antes de ingresar un Usuario")},a.edit=function(b){a.editing=!0,a.id=b._id,a.name=b.name,a.rut=b.rut,a.tipo=b.role,a.password=b.password},a.update=function(){a.user=b.get({id:a.id},function(){a.user.name=a.name,a.user.rut=a.rut,a.user.role=a.tipo,a.user.password=a.password,a.user.$update(function(){a.id="",a.name="",a.rut="",a.tipo="administrador",a.password="",a.editing=!1})})},a.cancelar=function(){a.id="",a.name="",a.rut="",a.tipo="administrador",a.password="",a.editing=!1},a["delete"]=function(c){b.remove({id:c._id}),a.usuarios.splice(this.$index,1)},a.$on("$destroy",function(){d.unsyncUpdates("producto")})}]),angular.module("posApp").config(["$stateProvider",function(a){a.state("usuarios",{url:"/usuarios",templateUrl:"app/usuarios/usuarios.html",controller:"UsuariosCtrl"})}]),angular.module("posApp").service("Orden",["$resource",function(a){return a("/api/ordenes/:id",{id:"@_id"},{update:{method:"PUT"}})}]),angular.module("posApp").service("Producto",["$resource",function(a){return a("/api/productos/:id",{id:"@_id"},{update:{method:"PUT"}})}]),angular.module("posApp").factory("Auth",["$http","User","$cookies","$q",function(a,b,c,d){var e=function(a){return angular.isFunction(a)?a:angular.noop},f={};return c.get("token")&&(f=b.get()),{login:function(g,h){return a.post("/auth/local",{rut:g.rut,password:g.password}).then(function(a){return c.put("token",a.data.token),f=b.get(),f.$promise}).then(function(a){return e(h)(null,a),a})["catch"](function(a){return this.logout(),e(h)(a.data),d.reject(a.data)}.bind(this))},logout:function(){c.remove("token"),f={}},createUser:function(a,c){return b.save(a,function(b){return e(c)(null,a)},function(a){return this.logout(),e(c)(a)}.bind(this)).$promise},changePassword:function(a,c,d){return b.changePassword({id:f._id},{oldPassword:a,newPassword:c},function(){return e(d)(null)},function(a){return e(d)(a)}).$promise},getCurrentUser:function(a){if(0===arguments.length)return f;var b=f.hasOwnProperty("$promise")?f.$promise:f;return d.when(b).then(function(b){return e(a)(b),b},function(){return e(a)({}),{}})},isLoggedIn:function(a){return 0===arguments.length?f.hasOwnProperty("role"):this.getCurrentUser(null).then(function(b){var c=b.hasOwnProperty("role");return e(a)(c),c})},isAdmin:function(a){return 0===arguments.length?"administrador"===f.role:this.getCurrentUser(null).then(function(b){var c="administrador"===b.role;return e(a)(c),c})},getRole:function(a){return 0===arguments.length?f.role:this.getCurrentUser(null).then(function(b){var c=b.role;return e(a)(c),c})},getToken:function(){return c.get("token")}}}]),angular.module("posApp").factory("User",["$resource",function(a){return a("/api/users/:id/:controller",{id:"@_id"},{changePassword:{method:"PUT",params:{controller:"password"}},get:{method:"GET",params:{id:"me"}},update:{method:"PUT"}})}]),angular.module("posApp").service("Counter",["$resource",function(a){return a("/api/counter/:id",{id:"@_id"},{update:{method:"PUT"}})}]),angular.module("posApp").directive("footer",function(){return{templateUrl:"components/footer/footer.html",restrict:"E",link:function(a,b){b.addClass("footer")}}}),angular.module("posApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirmar",html:"<p>Estas seguro que quieres borrar la orden # <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Borrar",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancelar",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("posApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}}),angular.module("posApp").controller("NavbarCtrl",["$scope","Auth",function(a,b){a.menu=[{title:"Caja",state:"caja",auth:[{role:"administrador"},{role:"caja"}]},{title:"Ventas",state:"main",auth:[{role:"administrador"},{role:"caja"},{role:"mesero"}]},{title:"Ordenes",state:"ordenes",auth:[{role:"administrador"},{role:"caja"},{role:"mesero"}]},{title:"Productos",state:"productos",auth:[{role:"administrador"}]},{title:"Usuarios",state:"usuarios",auth:[{role:"administrador"}]},{title:"Visor de Cocina",state:"cocina",auth:[{role:"administrador"},{role:"cocina"}]},{title:"Visor de Bar",state:"bar",auth:[{role:"administrador"},{role:"bar"}]},{title:"Reportes",state:"reportes",auth:[{role:"administrador"}]},{title:"Configuracion",state:"config",auth:[{role:"administrador"}]},{title:"Archivo",state:"archivo",auth:[{role:"administrador"}]}],a.getRole=b.getRole,a.isCollapsed=!0,a.isLoggedIn=b.isLoggedIn,a.isAdmin=b.isAdmin,a.getCurrentUser=b.getCurrentUser,a.check=function(a,b){return _.find(a,{role:b})?!0:!1}}]),angular.module("posApp").directive("navbar",function(){return{templateUrl:"components/navbar/navbar.html",restrict:"E",controller:"NavbarCtrl"}}),angular.module("posApp").factory("socket",["socketFactory",function(a){var b=io("http://pos.kangurubar.cl:8000",{path:"/socket.io-client"}),c=a({ioSocket:b});return{socket:c,syncUpdates:function(a,b,d){d=d||angular.noop,c.on(a+":save",function(a){var c=_.find(b,{_id:a._id}),e=b.indexOf(c),f="created";c?(b.splice(e,1,a),f="updated"):b.push(a),d(f,a,b)}),c.on(a+":remove",function(a){var c="deleted";_.remove(b,{_id:a._id}),d(c,a,b)})},unsyncUpdates:function(a){c.removeAllListeners(a+":save"),c.removeAllListeners(a+":remove")}}}]),angular.module("posApp").run(["$templateCache",function(a){a.put("app/account/login/login.html",'<div class=container><div class="panel panel-default" style=margin-top:100px><h3 class=text-center>INICIA SESION</h3><hr><div class=panel-body><div class=container-fluid><div class=row><div class=col-lg-12><form class=form name=form ng-submit=login(form) novalidate><div class=form-group><label>R.U.T</label><input type=rut name=rut class=form-control ng-model=user.rut required></div><div class=form-group><label>Contraseña</label><input type=password name=password class=form-control ng-model=user.password required></div><div class="form-group has-error"><p class=help-block ng-show="form.rut.$error.required && form.password.$error.required && submitted">Please enter your rut and password.</p><p class=help-block ng-show="form.rut.$error.rut && submitted">Please enter a valid email.</p><p class=help-block>{{ errors.other }}</p></div><div class=text-center><button class="btn btn-primary btn btn-login" type=submit>INGRESAR</button></div></form></div></div></div></div></div></div><footer></footer>'),a.put("app/archivo/archivo.html",'<navbar></navbar><div class=container><h3 class=text-center>ARCHIVO</h3><hr><div class=row><div class="col-lg-12 text-center"><div class="panel panel-default"><div class=panel-heading><input ng-model=busqueda.orden_id style=height:55px;font-size:26px class="form-control"></div><div class=panel-body><div class=container-fluid><div class=row><div class=text-center ng-if="cargando == true"><img src=assets/images/loading_spinner.d83212c1.gif width=50></div><div ng-repeat="orden in ordenes |  filter:busqueda" class="col-lg-6 col-lg-12"><div class="panel panel-default"><div class=panel-heading><div class=container-fluid><div class=row style=font-size:26px><div class="col-lg-4 col-xs-4 text-left"># {{orden.orden_id}}</div><div class="col-lg-4 col-xs-4 text-center">{{orden.mesa}}</div><div class="col-lg-4 col-xs-4 text-right">{{productCount(orden)}}</div></div></div></div><div class=panel-body><div class=container-fluid><button aria-hidden=true ng-click=ver(orden) style="font-size: 30px" class="btn-lg btn-primary glyphicon glyphicon-search"></button></div></div></div></div></div></div></div></div></div></div></div><footer></footer><script type=text/ng-template id=verOrden.html><div class="modal-header">\n        <h3 class="modal-title">Detalles de orden # {{orden.orden_id}}</h3>\n    </div>\n    <div class="modal-body">\n      <div><b>Orden ingresada por:</b> {{orden.usuario.name}}</div>\n      <div><b>Fecha:</b> {{ orden.fecha | date : \'d-M-yyyy - h:mm:ss a\' }}</div>\n      <div><b>Tipo de orden:</b> {{orden.tipo}}</div>\n      <div><b>Mesa:</b> {{orden.mesa}}</div>\n      <hr>\n      <div class="table-responsive">\n        <table class="table">\n          <thead>\n            <th class="text-left">Pagado</th>\n            <th>Cantidad</th>\n            <th>Producto</th>\n            <th>Precio</th>\n            <th class="text-center">Servido</td>\n          </thead>\n          <tr ng-repeat="producto in orden.productos">\n            <td class="text-left"><span ng-if="producto.pagado == false">{{showPagados(producto)}}</span><span ng-if="producto.pagado == true"  class="glyphicon glyphicon-ok"></span></td>\n            <td>{{producto.cantidad}}</td>\n            <td>{{producto.name}}</td>\n            <td>{{producto.precio * producto.cantidad | currency }}</td>\n            <td ng-if="producto.servido == true" class="text-center"><span class="glyphicon glyphicon-ok"></span></td>\n          </tr>\n        </table>\n      </div>\n      <hr>\n      <div class="text-center"><b>Subtotal:</b> {{calculateTotal()  | currency}}</div>\n      <div class="text-center"><b>Propina Sugerida (10%):</b> {{calculateTotal() * 0.10 | currency}}</div>\n      <div class="text-center"><b>Total:</b> {{calculateTotal() * 0.10 +  calculateTotal() | currency}}</div>\n    </div>\n    <div class="modal-footer">\n        <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>\n    </div></script>'),a.put("app/bar/bar.html",'<navbar></navbar><div class=container><h3 class=text-center>VISOR DE BARRA</h3><hr><div class=row><div class="col-lg-12 text-left"><div ng-repeat="orden in ordenes" ng-if=revisa(orden) class="orden col-lg-12 col-xs-12"><div class="panel panel-default"><div class=panel-heading><div class=container-fluid><div class=row><div class="col-lg-4 col-xs-4 text-left"><span style=font-size:20px><b># {{orden.orden_id}}</b></span></div><div class="col-lg-4 col-xs-4 text-center"><span style=font-size:20px>{{orden.usuario.name}}</span></div><div class="col-lg-4 col-xs-4 text-right"><span style=font-size:20px>{{orden.tipo}}</span></div></div></div></div><div class=panel-body><div ng-repeat="producto in orden.productos" class=productos><div ng-if="producto.tipo == \'bar\'" class=container-fluid><div class=row><div class="col-lg-2 col-xs-2 text-left"><span style=font-size:20px class=badge>{{producto.cantidad}}</span></div><div class="col-lg-5 col-xs-5 text-left"><span style=font-size:20px ng-if="producto.servido == false">{{producto.name}}</span> <span style=font-size:20px;text-decoration:line-through ng-if="producto.servido == true">{{producto.name}}</span></div><div class="col-lg-5 col-xs-5 text-right"><button aria-hidden=true ng-click="listo(orden, producto)" class="btn btn-success glyphicon glyphicon-ok"></button></div></div></div></div></div></div></div></div></div></div><footer></footer>'),a.put("app/caja/caja.html",'<navbar></navbar><div class=container><h3 class=text-center>CAJA</h3><hr><div class=row><div class="col-lg-12 text-center"><div class="panel panel-default"><div class=panel-heading><select ng-model=busqueda.usuario.name class=form-control><option value="">TODOS</option><option ng-repeat="usuario in usuarios" value={{usuario.name}}>{{usuario.name}}</option></select><input ng-model=busqueda.orden_id style=height:55px;font-size:26px class="form-control"></div><div class=panel-body><div class=container-fluid><div class=row><div ng-repeat="orden in ordenes |  filter:busqueda" ng-if=abierta(orden) class="col-lg-6 col-lg-12"><div class="panel panel-default"><div class=panel-heading><div class=container-fluid><div class=row style=font-size:24px><div class="col-lg-3 col-xs-3 text-left"># {{orden.orden_id}}</div><div class="col-lg-6 col-xs-6 text-center">{{orden.usuario.name}} - {{orden.mesa}}</div><div class="col-lg-3 col-xs-3 text-right">{{productCount(orden)}}</div></div></div></div><div class=panel-body><div class=container-fluid><button aria-hidden=true ng-click=edit(orden._id) style="font-size: 30px" class="btn-lg btn-success glyphicon glyphicon-pencil"></button> <button aria-hidden=true ng-click=ver(orden) style="font-size: 30px" class="btn-lg btn-primary glyphicon glyphicon-search"></button> <button aria-hidden=true ng-click="delete(orden.orden_id, orden)" ng-if="orden.status != \'Borrado\'" style="font-size: 30px" class="btn-lg btn-danger glyphicon glyphicon-remove"></button> <button aria-hidden=true ng-click=pay(orden) ng-if="orden.status != \'Borrado\'" style="font-size: 30px" class="btn-lg btn-success glyphicon glyphicon-usd"></button> <button aria-hidden=true ng-click=divide(orden) ng-if="orden.status != \'Borrado\'" style="font-size: 30px" class="btn-lg btn-success glyphicon glyphicon-th-list"></button></div></div></div></div></div></div></div></div></div></div></div><footer></footer><script type=text/ng-template id=verOrden.html><div class="modal-header">\n        <h3 class="modal-title">Detalles de orden # {{orden.orden_id}}</h3>\n    </div>\n    <div class="modal-body">\n      <div><b>Orden ingresada por:</b> {{orden.usuario.name}}</div>\n      <div><b>Fecha:</b> {{ orden.fecha | date : \'d-M-yyyy - h:mm:ss a\' }}</div>\n      <div><b>Tipo de orden:</b> {{orden.tipo}}</div>\n      <div><b>Mesa:</b> {{orden.mesa}}</div>\n      <hr>\n      <div class="table-responsive">\n        <table class="table">\n          <thead>\n            <th class="text-left">Pagado</th>\n            <th>Cantidad</th>\n            <th>Producto</th>\n            <th>Precio</th>\n            <th class="text-center">Servido</td>\n          </thead>\n          <tr ng-repeat="producto in orden.productos">\n            <td class="text-left"><span ng-if="producto.pagado == false">{{showPagados(producto)}}</span><span ng-if="producto.pagado == true"  class="glyphicon glyphicon-ok"></span></td>\n            <td>{{producto.cantidad}}</td>\n            <td>{{producto.name}}</td>\n            <td>{{producto.precio * producto.cantidad | currency }}</td>\n            <td ng-if="producto.servido == true" class="text-center"><span class="glyphicon glyphicon-ok"></span></td>\n          </tr>\n        </table>\n      </div>\n      <hr>\n      <div class="precioModal text-center"><b>Total:</b> {{calculateTotal()  | currency}}<hr><b>Por pagar:</b> {{calculatePendiente()  | currency}}</div>\n    </div>\n    <div class="modal-footer">\n        <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>\n    </div></script><script type=text/ng-template id=payOrden.html><div class="modal-header">\n        <h3 class="modal-title">Pagar orden # {{orden.orden_id}}</h3>\n    </div>\n    <div class="modal-body">\n    <div class="container-fluid">\n      <div><b>Orden ingresada por:</b> {{orden.usuario.name}}</div>\n      <div><b>Fecha:</b> {{ orden.fecha | date : \'d-M-yyyy - h:mm:ss a\' }}</div>\n      <div><b>Tipo de orden:</b> {{orden.tipo}}</div>\n      <div><b>Mesa:</b> {{orden.mesa}}</div>\n      <hr>\n      <div class="table-responsive">\n        <table class="table">\n          <thead>\n            <th class="text-left">Pagado</th>\n            <th>Cantidad</th>\n            <th>Producto</th>\n            <th>Precio</th>\n            <th class="text-center">Servido</td>\n          </thead>\n          <tr ng-repeat="producto in orden.productos">\n            <td class="text-left"><span ng-if="producto.pagado == false">{{showPagados(producto)}}</span><span ng-if="producto.pagado == true"  class="glyphicon glyphicon-ok"></span></td>\n            <td>{{producto.cantidad}}</td>\n            <td>{{producto.name}}</td>\n            <td>{{producto.precio * producto.cantidad | currency }}</td>\n            <td ng-if="producto.servido == true" class="text-center"><span class="glyphicon glyphicon-ok"></span></td>\n          </tr>\n        </table>        \n      <hr>\n      </div>\n      <div class="precioModal text-right">\n      <div class="row">\n        <div class="col-lg-6 col-xs-6 text-left"><b>Por pagar:</b> {{calculatePendiente()  | currency}}</div>\n        <div class="col-lg-6 col-xs-6"><b>Total:</b> {{calculatePendiente()  | currency}}</div>\n      </div>\n      <div ng-if="propina == true"><b>Propina:</b> {{ totalPropina | currency }}</div>\n      <div ng-if="propina == true"><b>Total mas Propina:</b> {{ totalWithPropina | currency }}</div>\n      <hr>\n      </div>\n\n      </div>      \n      <div class="container-fluid">\n        <div class="row">\n          <div class="col-lg-12 col-xs-12 text-center">\n            <input type="text" ng-model="data.ingreso" class="form-control"/>\n          </div>\n        </div>\n        <div class="row">\n          <div class="col-lg-12 col-xs-12 text-right">\n            <br>\n            <label ng-if="data.ingreso > calculateTotal()" class="precioModal">\n              Vuelto: {{data.ingreso - calculateTotal() - totalPropina | currency}}\n            </label>\n          </div>\n        </div>\n        <hr/>\n        <div class="container-fluid">\n          <div class="row">\n            <div class="col-lg-12 col-xs-12 text-right">\n              <select ng-model="tipoPago" class="form-control">\n                <option value="efectivo">Efectivo</option>\n                <option value="debito">Debito</option>\n                <option value="credito">Credito</option>\n              </select>\n            </div>\n          </div>\n        </div>\n        <hr/>\n        <div class="container-fluid">\n          <div class="row">\n            <div class="col-lg-3 col-xs-3 text-right">\n              <label class="precioModal"><b>Propina:</b></label>\n            </div>\n            <div class="col-lg-9 col-xs-9 text-center">\n              <button ng-click="aplicarPropina()" class="btn btn-{{propinaclass}} glyphicon glyphicon-usd"/></button>\n            </div>\n          </div>\n        </div>\n        <hr/>\n        <div class="container-fluid">\n          <div class="row">\n            <div class="col-lg-3 col-xs-3 text-right">\n              <label class="precioModal"><b># Boleta:</b></label>\n            </div>\n            <div class="col-lg-9 col-xs-9">\n              <input type="text" ng-model="numeroBoleta" class="form-control"/>\n            </div>\n          </div>\n        </div>\n      </div>      \n    </div>\n    <div class="modal-footer">\n        <div class="row">\n          <div class="col-lg-6 col-xs-6 text-left"><button class="btn-lg btn-warning" type="button" ng-click="cerrar()">CERRAR</button></div>\n          <div class="col-lg-6 col-xs-6"><button class="btn-lg btn-success" type="button" ng-click="pagar()">PAGAR</button></div>\n        </div>\n    </div></script><script type=text/ng-template id=divideOrden.html><div class="modal-header">\n        <h3 class="modal-title">Dividir Cuenta # {{o.orden_id}}</h3>\n    </div>\n    <div class="modal-body">\n      <div><b>Orden ingresada por:</b> {{o.usuario.name}}</div>\n      <div><b>Fecha:</b> {{ o.fecha | date : \'d-M-yyyy - h:mm:ss a\' }}</div>\n      <div><b>Tipo de orden:</b> {{o.tipo}}</div>\n      <div><b>Mesa:</b> {{o.mesa}}</div>\n      <hr>\n      <div class="table-responsive">\n        <table class="table">\n          <thead>\n            <th>Por Pagar</th>\n            <th>Producto</th>\n            <th>Precio</th>\n            <th>Pagar</th>\n          </thead>\n          <tr ng-repeat="producto in o.productos">\n            <td>{{producto.cantidad - producto.pagados}}</td>\n            <td>{{producto.name}}</td>\n            <td>{{producto.precio | currency }}</td>\n            <td>\n              <button\n              class="btn btn-success" \n              ng-click="pagar(producto)"\n              ng-if="producto.pagados - producto.cantidad">\n                <span class="glyphicon glyphicon-plus"></span>\n              </button>\n              <button class="btn btn-danger"\n              ng-click="revertir(producto)"\n              ng-if="checkSubticket(producto)">\n              <span class="glyphicon glyphicon-minus"></span>\n              </button>\n            </td>\n          </tr>\n        </table>\n      </div>\n      <hr>\n      <div class="table-responsive">\n        <table class="table">\n          <thead>\n            <th>Cantidad</th>\n            <th>Producto</th>\n            <th>Precio</th>\n          </thead>\n          <tr ng-repeat="item in subticket">\n            <td>{{item.cantidad}}</td>\n            <td>{{item.name}}</td>\n            <td>{{item.precio * item.cantidad | currency }}</td>\n          </tr>\n        </table>\n      </div>\n      <hr>\n      <div class="precioModal text-center"><b>Total Subcuenta:</b> {{calculateTotal() | currency}}</div>\n    </div>\n    <div class="modal-footer">\n        <div class="text-center">\n        <button class="btn-lg btn-warning" type="button" ng-click="cerrar()">CERRAR</button>\n        </div>\n    </div></script>'),
a.put("app/cocina/cocina.html",'<navbar></navbar><div class=container><h3 class=text-center>VISOR DE COCINA</h3><hr><div class=row><div class="col-lg-12 text-left"><div ng-repeat="orden in ordenes" ng-if=revisa(orden) class="col-lg-12 col-xs-12"><div class="panel panel-default"><div class=panel-heading><div class=container-fluid><div class=row><div class="col-lg-4 col-xs-4 text-left"><span style=font-size:20px><b># {{orden.orden_id}}</b></span></div><div class="col-lg-4 col-xs-4 text-center"><span style=font-size:20px><b>{{orden.usuario.name}}</b> | para {{orden.tipo}}</span></div><div class="col-lg-4 col-xs-4 text-right"><span style=font-size:20px>{{ orden.fechaEditado | date : \'h:mm:ss a\' }}</span></div></div></div></div><div class=panel-body><div ng-repeat="producto in orden.productos" class=productos><div ng-if="producto.tipo == \'cocina\'" class=container-fluid><div class=row><div class="col-lg-2 col-xs-2 text-left"><span style=font-size:20px class=badge>{{producto.cantidad}}</span></div><div class="col-lg-5 col-xs-5 text-left"><span style=font-size:20px ng-if="producto.servido == false">{{producto.name}}</span><span style=font-size:20px;text-decoration:line-through ng-if="producto.servido == true">{{producto.name}}</span></div><div class="col-lg-5 col-xs-5 text-right"><button aria-hidden=true ng-click="listo(orden, producto)" class="btn btn-success glyphicon glyphicon-ok"></button></div></div></div></div></div></div></div></div></div></div><footer></footer>'),a.put("app/config/config.html",'<navbar></navbar><div class=container><h3 class=text-center>CONFIGURACIONES</h3><hr><div class=container-fluid><div class=row><div class=col-lg-12><label>Contador de Ordenes:</label><span style=padding-left:10px><b>{{notification}}</b></span> <input ng-model=orden_id class=form-control><br><button class="btn btn-primary" ng-click=updateCounter(showNotification)>ACTUALIZAR</button></div></div></div></div><footer></footer>'),a.put("app/editar/editar.html",'<navbar></navbar><div class=container><h3 class=text-center>ORDEN # : {{data.orden_id}}</h3><hr><div class=row><div class=col-lg-6><div class="panel panel-default"><div class=panel-body><div class=row><div class=col-lg-4>Tipo de Orden:</div><div class=col-lg-8><select name=tipo ng-model=data.tipo class=form-control><option value=servir>Servir</option><option value=llevar>Llevar</option></select></div></div><div ng-if="data.tipo == \'servir\'" class=row><div class=col-lg-4>Mesa:</div><div class=col-lg-8><select name=mesa ng-model=data.mesa class=form-control><option value="t 1">t 1</option><option value="t 2">t 2</option><option value="t 3">t 3</option><option value="t 4">t 4</option><option value="t 5">t 5</option><option value="t 6">t 6</option><option value="t 7">t 7</option><option value="t 8">t 8</option><option value="t 9">t 9</option><option value="t 10">t 10</option><option value="t 11">t 11</option><option value="b 1">b 1</option><option value="b 2">b 2</option><option value="b 3">b 3</option><option value="b 4">b 4</option><option value="b 5">b 5</option><option value="b 6">b 6</option><option value="b 7">b 7</option><option value="b 8">b 8</option><option value="b 9">t 9</option><option value="p1 1">p1 1</option><option value="p1 2">p1 2</option><option value="p1 3">p1 3</option><option value="p1 4">p1 4</option><option value="p1 5">p1 5</option><option value="p2 1">p2 1</option><option value="p2 2">p2 2</option><option value="p2 3">p2 3</option><option value="p2 4">p2 4</option><option value="p2 5">p2 5</option><option value="p2 6">p2 6</option><option value="p2 7">p2 7</option><option value="p2 8">p2 8</option><option value="p2 9">p2 9</option><option value="p2 10">p2 10</option><option value="p2 11">p2 11</option><option value="p2 12">p2 12</option><option value="p2 13">p2 13</option><option value="p2 14">p2 14</option><option value="p2 15">p2 15</option><option value="p2 16">p2 16</option><option value="p2 17">p2 17</option><option value="br 1">br 1</option><option value="br 2">br 2</option><option value="br 3">br 3</option><option value="br 4">br 4</option></select></div></div><hr><div ng-repeat="item in ticket" class=container-fluid style=font-size:18px><div class=row><div class="col-lg-2 col-xs-2"><span class=badge style=font-size:18px>{{item.cantidad}}</span></div><div class="col-lg-4 col-xs-4 text-left">{{item.name}}</div><div class="col-lg-4 col-xs-4">{{item.precio * item.cantidad | currency}}</div><div class="col-lg-2 col-xs-2 text-rigth"><button aria-hidden=true ng-if="item.servido==false || userRole == \'administrador\'" ng-click=deleteItem(item) class="btn btn-danger glyphicon glyphicon-remove"></button></div></div><hr></div><div class=container-fluid><div class=row><div class="col-lg-12 text-center" style=font-size:18px>{{ calculateTotal() | currency }}</div></div><div class=row><div class="col-lg-12 text-center"><hr><button ng-click=updateTicket() class="btn-lg btn-success">ACTUALIZAR</button></div></div></div></div></div></div><div class=col-lg-6><div class="panel panel-default"><div class="panel-heading text-center"><input ng-model=producto class=form-control style="height:55px;font-size:26px"></div><div class=panel-body><div class=container-fluid><div class=row><div style="margin-bottom:10px;padding-top:10px;padding-bottom:10px;font-size:24px;white-space: normal" ng-repeat="producto in productos | filter:producto" ng-click=addToTicket(producto) class="col-lg-12 col-xs-12 btn btn-default">{{producto.name}}</div></div></div></div></div></div></div></div><footer></footer>'),a.put("app/main/main.html",'<navbar></navbar><div class=container><h3 class=text-center>VENTAS</h3><hr><div class=row><div class=col-lg-6><div class="panel panel-default"><div class=panel-body><div class=row><div class=col-lg-4>Tipo de Orden:</div><div class=col-lg-8><select name=tipo ng-model=data.tipo class=form-control><option value=servir>Servir</option><option value=llevar>Llevar</option></select></div></div><div ng-if="data.tipo == \'servir\'" class=row><div class=col-lg-4>Mesa:</div><div class=col-lg-8><select name=mesa ng-model=data.mesa class=form-control><option value="t 1">t 1</option><option value="t 2">t 2</option><option value="t 3">t 3</option><option value="t 4">t 4</option><option value="t 5">t 5</option><option value="t 6">t 6</option><option value="t 7">t 7</option><option value="t 8">t 8</option><option value="t 9">t 9</option><option value="t 10">t 10</option><option value="t 11">t 11</option><option value="b 1">b 1</option><option value="b 2">b 2</option><option value="b 3">b 3</option><option value="b 4">b 4</option><option value="b 5">b 5</option><option value="b 6">b 6</option><option value="b 7">b 7</option><option value="b 8">b 8</option><option value="b 9">t 9</option><option value="p1 1">p1 1</option><option value="p1 2">p1 2</option><option value="p1 3">p1 3</option><option value="p1 4">p1 4</option><option value="p1 5">p1 5</option><option value="p2 1">p2 1</option><option value="p2 2">p2 2</option><option value="p2 3">p2 3</option><option value="p2 4">p2 4</option><option value="p2 5">p2 5</option><option value="p2 6">p2 6</option><option value="p2 7">p2 7</option><option value="p2 8">p2 8</option><option value="p2 9">p2 9</option><option value="p2 10">p2 10</option><option value="p2 11">p2 11</option><option value="p2 12">p2 12</option><option value="p2 13">p2 13</option><option value="p2 14">p2 14</option><option value="p2 15">p2 15</option><option value="p2 16">p2 16</option><option value="p2 17">p2 17</option><option value="br 1">br 1</option><option value="br 2">br 2</option><option value="br 3">br 3</option><option value="br 4">br 4</option></select></div></div><hr><div ng-repeat="item in ticket" class=container-fluid style=font-size:18px><div class=row><div class="col-lg-2 col-xs-2"><span class=badge style=font-size:18px>{{item.cantidad}}</span></div><div class="col-lg-4 col-xs-4 text-left">{{item.name}}</div><div class="col-lg-4 col-xs-4">{{item.precio * item.cantidad | currency}}</div><div class="col-lg-2 col-xs-2 text-rigth"><button aria-hidden=true ng-click=deleteItem(item) class="btn btn-danger glyphicon glyphicon-remove"></button></div></div><hr></div><div class=container-fluid><div class=row><div class="col-lg-12 text-center" style=font-size:18px>{{ calculateTotal() | currency }}</div></div><div class=row><div class="col-lg-12 text-center"><hr><button ng-click=addTickeToQueue() class="btn-lg btn-success">INGRESAR</button></div></div></div></div></div></div><div class=col-lg-6><div class="panel panel-default"><div class="panel-heading text-center"><input ng-model=producto class=form-control style="height:55px;font-size:26px"></div><div class=panel-body><div class=container-fluid><div class=row><div style="margin-bottom:10px;padding-top:10px;padding-bottom:10px;font-size:24px;white-space: normal" ng-repeat="producto in productos | filter:producto" ng-click=addToTicket(producto) class="col-lg-12 col-xs-12 btn btn-default">{{producto.name}}</div></div></div></div></div></div></div></div><footer></footer>'),a.put("app/ordenes/ordenes.html",'<navbar></navbar><div class=container><h3 class=text-center>ORDENES</h3><hr><div class=row><div class="col-lg-12 text-center"><div class="panel panel-default"><div class=panel-heading><input ng-model=busqueda.orden_id style=height:55px;font-size:26px class="form-control"></div><div class=panel-body><div class=container-fluid><div class=row><div ng-repeat="orden in ordenes |  filter:busqueda" class="col-lg-6 col-lg-12"><div class="panel panel-default"><div class=panel-heading><div class=container-fluid><div class=row style=font-size:26px><div class="col-lg-4 col-xs-4 text-left"># {{orden.orden_id}}</div><div class="col-lg-4 col-xs-4 text-center">{{orden.mesa}}</div><div class="col-lg-4 col-xs-4 text-right">{{productCount(orden)}}</div></div></div></div><div class=panel-body><div class=container-fluid><button aria-hidden=true ng-click=edit(orden._id) style="font-size: 30px" class="btn-lg btn-success glyphicon glyphicon-pencil"></button> <button aria-hidden=true ng-click=ver(orden) style="font-size: 30px" class="btn-lg btn-primary glyphicon glyphicon-search"></button></div></div></div></div></div></div></div></div></div></div></div><footer></footer><script type=text/ng-template id=verOrden.html><div class="modal-header">\n        <h3 class="modal-title">Detalles de orden # {{orden.orden_id}}</h3>\n    </div>\n    <div class="modal-body">\n      <div><b>Orden ingresada por:</b> {{orden.usuario.name}}</div>\n      <div><b>Fecha:</b> {{ orden.fecha | date : \'d-M-yyyy - h:mm:ss a\' }}</div>\n      <div><b>Tipo de orden:</b> {{orden.tipo}}</div>\n      <div><b>Mesa:</b> {{orden.mesa}}</div>\n      <hr>\n      <div class="table-responsive">\n        <table class="table">\n          <thead>\n            <th class="text-left">Pagado</th>\n            <th>Cantidad</th>\n            <th>Producto</th>\n            <th>Precio</th>\n            <th class="text-center">Servido</td>\n          </thead>\n          <tr ng-repeat="producto in orden.productos">\n            <td class="text-left"><span ng-if="producto.pagado == false">{{showPagados(producto)}}</span><span ng-if="producto.pagado == true"  class="glyphicon glyphicon-ok"></span></td>\n            <td>{{producto.cantidad}}</td>\n            <td>{{producto.name}}</td>\n            <td>{{producto.precio * producto.cantidad | currency }}</td>\n            <td ng-if="producto.servido == true" class="text-center"><span class="glyphicon glyphicon-ok"></span></td>\n          </tr>\n        </table>\n      </div>\n      <hr>\n      <div class="text-center" style="font-size:18px;"><b>Subtotal:</b> {{calculatePendiente()  | currency}}</div>\n      <div class="text-center" style="font-size:18px;"><b>Propina Sugerida (10%):</b> {{calculatePendiente() * 0.10 | currency}}</div>\n      <div class="text-center" style="font-size:18px;"><b>Total:</b> {{calculatePendiente() * 0.10 +  calculatePendiente() | currency}}</div>\n    </div>\n    <div class="modal-footer">\n        <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>\n    </div></script>'),a.put("app/productos/productos.html",'<navbar></navbar><div class=container><h3 class=text-center>PRODUCTOS</h3><hr><div class=row><div class=col-lg-4><div class="panel panel-default"><div class=panel-body><form id=producto-form><div class=row><div class=col-lg-12><div id=error-message></div><label style=margin-top:10px>Nombre:</label><input name=nombre class=form-control ng-model="name"><label style=margin-top:10px>Precio:</label><input name=precio class=form-control ng-model="precio"><label style=margin-top:10px>Tipo:</label><select name=tipo class=form-control ng-model=tipo><option value=cocina>Cocina</option><option value=bar>Bar</option></select></div></div><div class=row><div class="col-lg-12 text-right"><button style=margin-top:20px ng-click=cancelar() ng-if="editing == true" class="btn btn-danger">CANCELAR</button> <button style=margin-top:20px ng-if="editing == true" ng-click=update() class="btn btn-success">ACTUALIZAR</button> <button style=margin-top:20px ng-if="editing != true" ng-click=add() class="btn btn-primary">INGRESAR</button></div></div></form></div></div></div><div class=col-lg-8><div class="panel panel-default"><div class="panel-heading text-center"><input class=form-control ng-model=search style=height:55px;font-size:26px></div><div class=panel-body><table class="table text-center" style=font-size:15px><thead style=font-weight:bold><td>Nombre</td><td>Precio</td><td>Editar</td></thead><tbody><tr ng-repeat="producto in productos  |  filter:search"><td>{{producto.name}}</td><td>{{producto.precio | currency}}</td><td><button aria-hidden=true ng-click=edit(producto) class="btn btn-success glyphicon glyphicon-pencil"></button> <button aria-hidden=true ng-click=delete(producto) class="btn btn-danger glyphicon glyphicon-remove"></button></td></tr></tbody></table></div></div></div></div></div>'),a.put("app/reportes/reportes.html",'<navbar></navbar><div class=container><h3 class=text-center>REPORTES</h3><hr><div class=container-fluid><div class=row><div class="col-lg-12 col-xs-12"><label>Usuario:</label><select ng-model=user class=form-control ng-change=search()><option value=todos>Todos</option><option ng-repeat="usuario in usuarios" value={{usuario.name}}>{{usuario.name}}</option></select></div></div><div class=row><div class="col-lg-12 col-xs-12"><br><!-- 	    <label>Producto: </label>\n	      <select ng-model="productoField" class="form-control" ng-change="search()">\n	        <option value="todos">Todos</option>\n	        <option ng-repeat="producto in productos" value="{{producto.name}}">{{producto.name}}</option>\n	      </select> --><div class="panel panel-default"><div class="panel-heading text-center"><input ng-model=productoField ng-change=search() class=form-control style="height:55px;font-size:26px"></div><div class=panel-body><div class=container-fluid><div class=row><div style="margin-bottom:10px;padding-top:10px;padding-bottom:10px;font-size:24px;white-space: normal" ng-repeat="producto in productos | filter:productoField" ng-click=change(producto.name) class="col-lg-12 col-xs-12 btn btn-default">{{producto.name}}</div></div></div></div></div></br></div></div><div class=row><div class="col-lg-6 col-xs-6"><br><label>Desde:</label><p class=input-group><input datepicker-popup={{format}} ng-change=search() ng-model=desde is-open=desde.status.opened min-date=minDate max-date="\'2020-06-22\'" datepicker-options=dateOptions date-disabled="disabled(date, mode)" ng-required=true close-text=Cerrar class="form-control"><span class=input-group-btn><button type=button name=desde ng-click=open($event) class="btn btn-default"><i class="glyphicon glyphicon-calendar"></i></button></span></p><input ng-model=desdeTime class="form-control"></div><div class="col-lg-6 col-xs-6"><br><label>Hasta:</label><p class=input-group><input datepicker-popup={{format}} ng-change=search() ng-model=hasta is-open=hasta.status.opened max-date="\'2020-06-22\'" datepicker-options=dateOptions date-disabled="disabled(date, mode)" ng-required=true close-text=Cerrar class="form-control"><span class=input-group-btn><button type=button name=hasta ng-click=open($event) class="btn btn-default"><i class="glyphicon glyphicon-calendar"></i></button></span></p><input ng-model=hastaTime class="form-control"></div></div><div class=row><div class="col-lg-12 col-xs-12 text-right"><br><button ng-click=search() class="btn-lg btn-danger" disabled ng-if="cargando == true">CARGANDO ORDENES...</button> <button ng-click=search() class="btn-lg btn-success" ng-if="cargando == false">GENERAR REPORTE</button></div></div></div><div class=panel-body><div class=container-fluid style=font-size:18px><div class=row><div ng-if=cocinaTotal class="col-xs-12 col-lg-12 text-left">Ventas en productos de Cocina: <b>{{ cocinaTotal | currency }}</b></div></div><div class=row><div ng-if="barTotal &gt; 0" class="col-xs-12 col-lg-12 text-left">Ventas en productos de Bar: <b>{{ barTotal | currency }}</b></div></div><hr><div class=row><div ng-if="barTotal &gt; 0" class="col-xs-12 col-lg-12 text-left">Venta Total del Local: <b>{{ barTotal + cocinaTotal | currency }}</b></div><br><br></div><div class=row><div ng-if="cantidadTotalProducto &gt; 0">{{productoField}}: {{cantidadTotalProducto}} vendido(s)<br>Total producto vendido: {{productoTotal | currency }}<br><br></div></div><div class=row><div ng-repeat="orden in ordenes |  filter:busqueda" class="col-lg-6 col-lg-12"><div class="panel panel-default"><div class=panel-heading><div class=container-fluid><div class=row style=font-size:26px><div class="col-lg-4 col-xs-4 text-left"># {{orden.orden_id}}</div><div class="col-lg-4 col-xs-4 text-center">{{orden.mesa}}</div><div class="col-lg-4 col-xs-4 text-right">{{productCount(orden)}}</div></div></div></div><div class=panel-body><div class="container-fluid text-center"><button aria-hidden=true ng-click=ver(orden) style="font-size: 30px" class="btn-lg btn-primary glyphicon glyphicon-search"></button></div></div></div></div></div></div></div></div><footer></footer><script type=text/ng-template id=verOrden.html><div class="modal-header">\n        <h3 class="modal-title">Detalles de orden # {{orden.orden_id}}</h3>\n    </div>\n    <div class="modal-body">\n      <div><b>Orden ingresada por:</b> {{orden.usuario.name}}</div>\n      <div><b>Fecha:</b> {{ orden.fecha | date : \'d-M-yyyy - h:mm:ss a\' }}</div>\n      <div><b>Tipo de orden:</b> {{orden.tipo}}</div>\n      <div><b>Mesa:</b> {{orden.mesa}}</div>\n      <hr>\n      <div class="table-responsive">\n        <table class="table">\n          <thead>\n            <th>Cantidad</th>\n            <th>Producto</th>\n            <th>Precio</th>\n            <th class="text-center">Servido</td>\n          </thead>\n          <tr ng-repeat="producto in orden.productos">\n  \n            <td>{{producto.cantidad}}</td>\n            <td>{{producto.name}}</td>\n            <td>{{producto.precio * producto.cantidad | currency }}</td>\n            <td ng-if="producto.servido == true" class="text-center"><span class="glyphicon glyphicon-ok"></span></td>\n          </tr>\n        </table>\n      </div>\n      <hr>\n      <div class="text-center"><b>Total:</b> {{calculateTotal()  | currency}}</div>\n    </div>\n    <div class="modal-footer">\n        <button class="btn btn-warning" type="button" ng-click="cancel()">Cancel</button>\n    </div></script>'),a.put("app/usuarios/usuarios.html",'<navbar></navbar><div class=container><h3 class=text-center>USUARIOS</h3><hr><div class=row><div class="col-lg-4 text-left"><div class="panel panel-default"><div class=panel-body><form id=usuario-form><div class=row><div class=col-lg-12><div id=error-message></div><label style=margin-top:10px>Nombre:</label><input name=nombre class=form-control ng-model="name"><label style=margin-top:10px>R.U.T:</label><input name=rut class=form-control ng-model="rut"><label style=margin-top:10px>Contraseña:</label><input name=password class=form-control ng-model="password"><label style=margin-top:10px>Tipo de Usuario:</label><select ng-model=tipo required class=form-control><option value=administrador>Administrador</option><option value=caja>Caja</option><option value=cocina>Cocina</option><option value=mesero>Mesero</option><option value=bar>Bar</option></select></div></div><div class=row><div class="col-lg-12 text-right"><button style=margin-top:20px ng-click=add() ng-if="editing != true" class="btn btn-primary">INGRESAR</button> <button style=margin-top:20px ng-click=cancelar() ng-if="editing == true" class="btn btn-danger">CANCELAR</button> <button style=margin-top:20px ng-click=update() ng-if="editing == true" class="btn btn-success">ACTUALIZAR</button></div></div></form></div></div></div><div class="col-lg-8 text-center"><div class="panel panel-default"><div class="panel-heading text-center"><input class=form-control ng-model=search style=height:55px;font-size:26px></div><div class=panel-body><div class=table-responsive><table class="table text-center" style=font-size:15px><thead style=font-weight:bold><td>Nombre</td><td>R.U.T</td><td>Rol</td><td>Editar</td></thead><tbody><tr ng-repeat="usuario in usuarios  |  filter:search" ng-if="usuario.name != \'Admin\'"><td>{{usuario.name}}</td><td>{{usuario.rut}}</td><td>{{usuario.role}}</td><td><button aria-hidden=true ng-click=edit(usuario) class="btn btn-success glyphicon glyphicon-pencil"></button> <button aria-hidden=true ng-click=delete(usuario) class="btn btn-danger glyphicon glyphicon-remove"></button></td></tr></tbody></table></div></div></div></div></div></div><footer></footer>'),a.put("components/footer/footer.html","<div class=container><p>Sistema de Ventas v3.0 | <a href=#>Jesus Villarroel</a> | <a href=#>jvr42@hotmail.com</a></p></div>"),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<div class="navbar navbar-default navbar-static-top" ng-controller=NavbarCtrl><div class=container><div class=navbar-header><button class=navbar-toggle type=button ng-click="isCollapsed = !isCollapsed"><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a class=navbar-brand>POS</a></div><div collapse=isCollapsed class="navbar-collapse collapse" id=navbar-main><ul class="nav navbar-nav"><li ng-repeat="item in menu" ui-sref-active=active><a ng-show=isLoggedIn() ng-if="check(item.auth, getRole())" ui-sref={{item.state}}>{{item.title}}</a></li></ul><ul class="nav navbar-nav navbar-right"><li ng-hide=isLoggedIn() ui-sref-active=active><a ui-sref=login>Iniciar Sesion</a></li><li ng-show=isLoggedIn()><p class=navbar-text>{{ getCurrentUser().name }}</p></li><li ng-show=isLoggedIn()><a ui-sref=logout>Cerrar Sesion</a></li></ul></div></div></div>')}]);